/*! For license information please see 227.562fcf48.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkbel_frontend=self.webpackChunkbel_frontend||[]).push([[227],{85854:function(e,t,n){n.d(t,{$s:function(){return ie},BH:function(){return I},DV:function(){return H},GJ:function(){return U},L:function(){return _},LL:function(){return M},P0:function(){return w},Sg:function(){return T},UI:function(){return V},US:function(){return p},Wl:function(){return q},Yr:function(){return R},ZR:function(){return O},aH:function(){return C},b$:function(){return N},cI:function(){return F},dS:function(){return X},eu:function(){return P},g5:function(){return d},gK:function(){return Q},gQ:function(){return $},h$:function(){return v},hl:function(){return Z},hu:function(){return h},m9:function(){return ae},p$:function(){return g},r3:function(){return B},ru:function(){return x},uI:function(){return E},ug:function(){return J},vZ:function(){return K},w9:function(){return j},xO:function(){return G},xb:function(){return z},zI:function(){return D}});var r=n(29439),i=n(97326),a=n(60136),o=n(27277),s=n(98737),u=n(15671),c=n(43144),l={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},h=function(e,t){if(!e)throw d(t)},d=function(e){return new Error("Firebase Database ("+l.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},f=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},p={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,l=a>>2,h=(3&a)<<4|s>>4,d=(15&s)<<2|c>>6,f=63&c;u||(f=64,o||(d=64)),r.push(n[l],n[h],n[d],n[f])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(f(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var s=e[n++],u=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&u)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==u)throw Error();var c=a<<2|o>>4;if(r.push(c),64!==s){var l=o<<4&240|s>>2;if(r.push(l),64!==u){var h=s<<6&192|u;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},v=function(e){var t=f(e);return p.encodeByteArray(t,!0)},_=function(e){return v(e).replace(/\./g,"")},y=function(e){try{return p.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function g(e){return m(void 0,e)}function m(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=m(e[n],t[n]));return e}var k=function(){return function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__},b=function(){try{return k()||function(){if("undefined"!==typeof process){var e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0}}()||function(){if("undefined"!==typeof document){var e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(n){return}var t=e&&y(e[1]);return t&&JSON.parse(t)}}()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},w=function(e){var t=function(e){var t,n;return null===(n=null===(t=b())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]}(e);if(t){var n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));var r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]}},C=function(){var e;return null===(e=b())||void 0===e?void 0:e.config},I=function(){function e(){var t=this;(0,u.Z)(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return(0,c.Z)(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();function T(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var a=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[_(JSON.stringify({alg:"none",type:"JWT"})),_(JSON.stringify(a)),""].join(".")}function S(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function E(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(S())}function x(){var e="object"===typeof chrome?chrome.runtime:"object"===typeof browser?browser.runtime:void 0;return"object"===typeof e&&void 0!==e.id}function N(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function R(){return!0===l.NODE_CLIENT||!0===l.NODE_ADMIN}function Z(){try{return"object"===typeof indexedDB}catch(e){return!1}}function P(){return new Promise((function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=function(){i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=function(){n=!1},i.onerror=function(){var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(a){t(a)}}))}function D(){return!("undefined"===typeof navigator||!navigator.cookieEnabled)}var A="FirebaseError",O=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,u.Z)(this,n),(o=t.call(this,r)).code=e,o.customData=a,o.name=A,Object.setPrototypeOf((0,i.Z)(o),n.prototype),Error.captureStackTrace&&Error.captureStackTrace((0,i.Z)(o),M.prototype.create),o}return(0,c.Z)(n)}((0,s.Z)(Error)),M=function(){function e(t,n,r){(0,u.Z)(this,e),this.service=t,this.serviceName=n,this.errors=r}return(0,c.Z)(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?function(e,t){return e.replace(L,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,").");return new O(n,a,t)}}]),e}();var L=/\{\$([^}]+)}/g;function F(e){return JSON.parse(e)}function q(e){return JSON.stringify(e)}var W=function(e){var t={},n={},r={},i="";try{var a=e.split(".");t=F(y(a[0])||""),n=F(y(a[1])||""),i=a[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}},j=function(e){var t=W(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")},U=function(e){var t=W(e).claims;return"object"===typeof t&&!0===t.admin};function B(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function H(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function z(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function V(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function K(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var s=e[o],u=t[o];if(Y(s)&&Y(u)){if(!K(s,u))return!1}else if(s!==u)return!1}for(var c=0,l=r;c<l.length;c++){var h=l[c];if(!n.includes(h))return!1}return!0}function Y(e){return null!==e&&"object"===typeof e}function G(e){for(var t=[],n=function(){var e=(0,r.Z)(a[i],2),n=e[0],o=e[1];Array.isArray(o)?o.forEach((function(e){t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(o))},i=0,a=Object.entries(e);i<a.length;i++)n();return t.length?"&"+t.join("&"):""}var $=function(){function e(){(0,u.Z)(this,e),this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return(0,c.Z)(e,[{key:"reset",value:function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}},{key:"compress_",value:function(e,t){t||(t=0);var n=this.W_;if("string"===typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(var i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(var a=16;a<80;a++){var o=n[a-3]^n[a-8]^n[a-14]^n[a-16];n[a]=4294967295&(o<<1|o>>>31)}for(var s,u,c=this.chain_[0],l=this.chain_[1],h=this.chain_[2],d=this.chain_[3],f=this.chain_[4],p=0;p<80;p++){p<40?p<20?(s=d^l&(h^d),u=1518500249):(s=l^h^d,u=1859775393):p<60?(s=l&h|d&(l|h),u=2400959708):(s=l^h^d,u=3395469782);var v=(c<<5|c>>>27)+s+f+u+n[p]&4294967295;f=d,d=h,h=4294967295&(l<<30|l>>>2),l=c,c=v}this.chain_[0]=this.chain_[0]+c&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+d&4294967295,this.chain_[4]=this.chain_[4]+f&4294967295}},{key:"update",value:function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,a=this.inbuf_;r<t;){if(0===a)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[a]=e.charCodeAt(r),++r,++a===this.blockSize){this.compress_(i),a=0;break}}else for(;r<t;)if(i[a]=e[r],++r,++a===this.blockSize){this.compress_(i),a=0;break}}this.inbuf_=a,this.total_+=t}}},{key:"digest",value:function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,i=0;i<5;i++)for(var a=24;a>=0;a-=8)e[r]=this.chain_[i]>>a&255,++r;return e}}]),e}();function Q(e,t){return"".concat(e," failed: ").concat(t," argument ")}var X=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;r++,h(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},J=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t},ee=1e3,te=2,ne=144e5,re=.5;function ie(e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te,n=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee)*Math.pow(t,e),r=Math.round(re*n*(Math.random()-.5)*2);return Math.min(ne,n+r)}function ae(e){return e&&e._delegate?e._delegate:e}},15861:function(e,t,n){function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}n.d(t,{Z:function(){return i}})},89474:function(e,t,n){n.d(t,{Jn:function(){return R},KN:function(){return D},Mq:function(){return P},Xd:function(){return T},ZF:function(){return Z},qX:function(){return S}});var r,i,a=n(93433),o=n(74165),s=n(15861),u=n(37762),c=n(4942),l=n(15671),h=n(43144),d=n(23258),f=n(6781),p=n(85854),v=n(59073),_=function(){function e(t){(0,l.Z)(this,e),this.container=t}return(0,h.Z)(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var y="@firebase/app",g="0.9.3",m=new f.Yd("@firebase/app"),k="[DEFAULT]",b=(r={},(0,c.Z)(r,y,"fire-core"),(0,c.Z)(r,"@firebase/app-compat","fire-core-compat"),(0,c.Z)(r,"@firebase/analytics","fire-analytics"),(0,c.Z)(r,"@firebase/analytics-compat","fire-analytics-compat"),(0,c.Z)(r,"@firebase/app-check","fire-app-check"),(0,c.Z)(r,"@firebase/app-check-compat","fire-app-check-compat"),(0,c.Z)(r,"@firebase/auth","fire-auth"),(0,c.Z)(r,"@firebase/auth-compat","fire-auth-compat"),(0,c.Z)(r,"@firebase/database","fire-rtdb"),(0,c.Z)(r,"@firebase/database-compat","fire-rtdb-compat"),(0,c.Z)(r,"@firebase/functions","fire-fn"),(0,c.Z)(r,"@firebase/functions-compat","fire-fn-compat"),(0,c.Z)(r,"@firebase/installations","fire-iid"),(0,c.Z)(r,"@firebase/installations-compat","fire-iid-compat"),(0,c.Z)(r,"@firebase/messaging","fire-fcm"),(0,c.Z)(r,"@firebase/messaging-compat","fire-fcm-compat"),(0,c.Z)(r,"@firebase/performance","fire-perf"),(0,c.Z)(r,"@firebase/performance-compat","fire-perf-compat"),(0,c.Z)(r,"@firebase/remote-config","fire-rc"),(0,c.Z)(r,"@firebase/remote-config-compat","fire-rc-compat"),(0,c.Z)(r,"@firebase/storage","fire-gcs"),(0,c.Z)(r,"@firebase/storage-compat","fire-gcs-compat"),(0,c.Z)(r,"@firebase/firestore","fire-fst"),(0,c.Z)(r,"@firebase/firestore-compat","fire-fst-compat"),(0,c.Z)(r,"fire-js","fire-js"),(0,c.Z)(r,"firebase","fire-js-all"),r),w=new Map,C=new Map;function I(e,t){try{e.container.addComponent(t)}catch(n){m.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function T(e){var t=e.name;if(C.has(t))return m.debug("There were multiple attempts to register component ".concat(t,".")),!1;C.set(t,e);var n,r=(0,u.Z)(w.values());try{for(r.s();!(n=r.n()).done;){I(n.value,e)}}catch(i){r.e(i)}finally{r.f()}return!0}function S(e,t){var n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}var E=(i={},(0,c.Z)(i,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),(0,c.Z)(i,"bad-app-name","Illegal App name: '{$appName}"),(0,c.Z)(i,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),(0,c.Z)(i,"app-deleted","Firebase App named '{$appName}' already deleted"),(0,c.Z)(i,"no-options","Need to provide options, when not being deployed to hosting via source."),(0,c.Z)(i,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),(0,c.Z)(i,"invalid-log-argument","First argument to `onLog` must be null or a function."),(0,c.Z)(i,"idb-open","Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}."),(0,c.Z)(i,"idb-get","Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}."),(0,c.Z)(i,"idb-set","Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}."),(0,c.Z)(i,"idb-delete","Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."),i),x=new p.LL("app","Firebase",E),N=function(){function e(t,n,r){var i=this;(0,l.Z)(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new d.wA("app",(function(){return i}),"PUBLIC"))}return(0,h.Z)(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw x.create("app-deleted",{appName:this._name})}}]),e}(),R="9.17.1";function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e;"object"!==typeof t&&(t={name:t});var r=Object.assign({name:k,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!==typeof i||!i)throw x.create("bad-app-name",{appName:String(i)});if(n||(n=(0,p.aH)()),!n)throw x.create("no-options");var a=w.get(i);if(a){if((0,p.vZ)(n,a.options)&&(0,p.vZ)(r,a.config))return a;throw x.create("duplicate-app",{appName:i})}var o,s=new d.H0(i),c=(0,u.Z)(C.values());try{for(c.s();!(o=c.n()).done;){var l=o.value;s.addComponent(l)}}catch(f){c.e(f)}finally{c.f()}var h=new N(n,r,s);return w.set(i,h),h}function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=w.get(e);if(!t&&e===k)return Z();if(!t)throw x.create("no-app",{appName:e});return t}function D(e,t,n){var r,i=null!==(r=b[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var s=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&s.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void m.warn(s.join(" "))}T(new d.wA("".concat(i,"-version"),(function(){return{library:i,version:t}}),"VERSION"))}var A="firebase-heartbeat-database",O=1,M="firebase-heartbeat-store",L=null;function F(){return L||(L=(0,v.X3)(A,O,{upgrade:function(e,t){if(0===t)e.createObjectStore(M)}}).catch((function(e){throw x.create("idb-open",{originalErrorMessage:e.message})}))),L}function q(e){return W.apply(this,arguments)}function W(){return(W=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F();case 3:return n=e.sent,e.abrupt("return",n.transaction(M).objectStore(M).get(B(t)));case 7:e.prev=7,e.t0=e.catch(0),e.t0 instanceof p.ZR?m.warn(e.t0.message):(r=x.create("idb-get",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),m.warn(r.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function j(e,t){return U.apply(this,arguments)}function U(){return(U=(0,s.Z)((0,o.Z)().mark((function e(t,n){var r,i,a,s;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F();case 3:return r=e.sent,i=r.transaction(M,"readwrite"),a=i.objectStore(M),e.next=8,a.put(n,B(t));case 8:return e.abrupt("return",i.done);case 11:e.prev=11,e.t0=e.catch(0),e.t0 instanceof p.ZR?m.warn(e.t0.message):(s=x.create("idb-set",{originalErrorMessage:null===e.t0||void 0===e.t0?void 0:e.t0.message}),m.warn(s.message));case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function B(e){return"".concat(e.name,"!").concat(e.options.appId)}var H=1024,z=function(){function e(t){var n=this;(0,l.Z)(this,e),this.container=t,this._heartbeatsCache=null;var r=this.container.getProvider("app").getImmediate();this._storage=new G(r),this._heartbeatsCachePromise=this._storage.read().then((function(e){return n._heartbeatsCache=e,e}))}return(0,h.Z)(e,[{key:"triggerHeartbeat",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.container.getProvider("platform-logger").getImmediate(),n=t.getPlatformInfoString(),r=V(),null!==this._heartbeatsCache){e.next=7;break}return e.next=6,this._heartbeatsCachePromise;case 6:this._heartbeatsCache=e.sent;case 7:if(this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((function(e){return e.date===r}))){e.next=11;break}return e.abrupt("return");case 11:this._heartbeatsCache.heartbeats.push({date:r,agent:n});case 12:return this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((function(e){var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),e.abrupt("return",this._storage.overwrite(this._heartbeatsCache));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeartbeatsHeader",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t,n,r,i,a;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._heartbeatsCache){e.next=3;break}return e.next=3,this._heartbeatsCachePromise;case 3:if(null!==this._heartbeatsCache&&0!==this._heartbeatsCache.heartbeats.length){e.next=5;break}return e.abrupt("return","");case 5:if(t=V(),n=K(this._heartbeatsCache.heartbeats),r=n.heartbeatsToSend,i=n.unsentEntries,a=(0,p.L)(JSON.stringify({version:2,heartbeats:r})),this._heartbeatsCache.lastSentHeartbeatDate=t,!(i.length>0)){e.next=15;break}return this._heartbeatsCache.heartbeats=i,e.next=13,this._storage.overwrite(this._heartbeatsCache);case 13:e.next=17;break;case 15:this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);case 17:return e.abrupt("return",a);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function V(){return(new Date).toISOString().substring(0,10)}function K(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:H,r=[],i=e.slice(),a=(0,u.Z)(e);try{var o=function(){var e=t.value,a=r.find((function(t){return t.agent===e.agent}));if(a){if(a.dates.push(e.date),$(r)>n)return a.dates.pop(),"break"}else if(r.push({agent:e.agent,dates:[e.date]}),$(r)>n)return r.pop(),"break";i=i.slice(1)};for(a.s();!(t=a.n()).done;){if("break"===o())break}}catch(s){a.e(s)}finally{a.f()}return{heartbeatsToSend:r,unsentEntries:i}}var Y,G=function(){function e(t){(0,l.Z)(this,e),this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}return(0,h.Z)(e,[{key:"runIndexedDBEnvironmentCheck",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,p.hl)()){e.next=4;break}return e.abrupt("return",!1);case 4:return e.abrupt("return",(0,p.eu)().then((function(){return!0})).catch((function(){return!1})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return",{heartbeats:[]});case 7:return e.next=9,q(this.app);case 9:return t=e.sent,e.abrupt("return",t||{heartbeats:[]});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"overwrite",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",j(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:t.heartbeats}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",j(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:[].concat((0,a.Z)(r.heartbeats),(0,a.Z)(t.heartbeats))}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function $(e){return(0,p.L)(JSON.stringify({version:2,heartbeats:e})).length}Y="",T(new d.wA("platform-logger",(function(e){return new _(e)}),"PRIVATE")),T(new d.wA("heartbeat",(function(e){return new z(e)}),"PRIVATE")),D(y,g,Y),D(y,g,"esm2017"),D("fire-js","")},23258:function(e,t,n){n.d(t,{H0:function(){return p},wA:function(){return h}});var r=n(74165),i=n(93433),a=n(15861),o=n(29439),s=n(37762),u=n(15671),c=n(43144),l=n(85854),h=function(){function e(t,n,r){(0,u.Z)(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return(0,c.Z)(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),d="[DEFAULT]",f=function(){function e(t,n){(0,u.Z)(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return(0,c.Z)(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new l.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(i){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:d})}catch(l){}var t,n=(0,s.Z)(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,o.Z)(t.value,2),i=r[0],a=r[1],u=this.normalizeInstanceIdentifier(i);try{var c=this.getOrInitializeService({instanceIdentifier:u});a.resolve(c)}catch(l){}}}catch(h){n.e(h)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat((0,i.Z)(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),(0,i.Z)(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,a=this.getOrInitializeService({instanceIdentifier:r,options:n}),u=(0,s.Z)(this.instancesDeferred.entries());try{for(u.s();!(i=u.n()).done;){var c=(0,o.Z)(i.value,2),l=c[0],h=c[1];r===this.normalizeInstanceIdentifier(l)&&h.resolve(a)}}catch(d){u.e(d)}finally{u.f()}return a}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=(0,s.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(o){}}}catch(u){i.e(u)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===d?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(o){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;return this.component?this.component.multipleInstances?e:d:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();var p=function(){function e(t){(0,u.Z)(this,e),this.name=t,this.providers=new Map}return(0,c.Z)(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new f(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}()},6781:function(e,t,n){n.d(t,{Yd:function(){return f},in:function(){return i}});var r,i,a=n(15671),o=n(43144),s=n(4942),u=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));var c={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},l=i.INFO,h=(r={},(0,s.Z)(r,i.DEBUG,"log"),(0,s.Z)(r,i.VERBOSE,"log"),(0,s.Z)(r,i.INFO,"info"),(0,s.Z)(r,i.WARN,"warn"),(0,s.Z)(r,i.ERROR,"error"),r),d=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=h[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i,a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},f=function(){function e(t){(0,a.Z)(this,e),this.name=t,this._logLevel=l,this._logHandler=d,this._userLogHandler=null,u.push(this)}return(0,o.Z)(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in i))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"===typeof e?c[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.DEBUG].concat(t)),this._logHandler.apply(this,[this,i.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.VERBOSE].concat(t)),this._logHandler.apply(this,[this,i.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.INFO].concat(t)),this._logHandler.apply(this,[this,i.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.WARN].concat(t)),this._logHandler.apply(this,[this,i.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,i.ERROR].concat(t)),this._logHandler.apply(this,[this,i.ERROR].concat(t))}}]),e}()},65390:function(e,t,n){n.d(t,{IH:function(){return Pt}});var r,i=n(29439),a=n(37762),o=n(15671),s=n(43144),u=n(4942),c=n(74165),l=n(15861),h=n(89474),d=n(6781),f=n(85854),p=n(23258),v=n(93433),_=n(59073),y="@firebase/installations",g="0.6.3",m=1e4,k="w:".concat(g),b="FIS_v2",w="https://firebaseinstallations.googleapis.com/v1",C=36e5,I=(r={},(0,u.Z)(r,"missing-app-config-values",'Missing App configuration value: "{$valueName}"'),(0,u.Z)(r,"not-registered","Firebase Installation is not registered."),(0,u.Z)(r,"installation-not-found","Firebase Installation not found."),(0,u.Z)(r,"request-failed",'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"'),(0,u.Z)(r,"app-offline","Could not process request. Application offline."),(0,u.Z)(r,"delete-pending-registration","Can't delete installation while there is a pending registration request."),r),T=new f.LL("installations","Installations",I);function S(e){return e instanceof f.ZR&&e.code.includes("request-failed")}function E(e){var t=e.projectId;return"".concat(w,"/projects/").concat(t,"/installations")}function x(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}function N(e,t){return R.apply(this,arguments)}function R(){return(R=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.json();case 2:return r=e.sent,i=r.error,e.abrupt("return",T.create("request-failed",{requestName:t,serverCode:i.code,serverMessage:i.message,serverStatus:i.status}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){var t=e.apiKey;return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function P(e,t){var n=t.refreshToken,r=Z(e);return r.append("Authorization",function(e){return"".concat(b," ").concat(e)}(n)),r}function D(e){return A.apply(this,arguments)}function A(){return(A=(0,l.Z)((0,c.Z)().mark((function e(t){var n;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t();case 2:if(!((n=e.sent).status>=500&&n.status<600)){e.next=5;break}return e.abrupt("return",t());case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e,t){return M.apply(this,arguments)}function M(){return(M=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r,i,a,o,s,u,l,h,d,f,p,v;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.appConfig,i=t.heartbeatServiceProvider,a=n.fid,o=E(r),s=Z(r),!(u=i.getImmediate({optional:!0}))){e.next=10;break}return e.next=8,u.getHeartbeatsHeader();case 8:(l=e.sent)&&s.append("x-firebase-client",l);case 10:return h={fid:a,authVersion:b,appId:r.appId,sdkVersion:k},d={method:"POST",headers:s,body:JSON.stringify(h)},e.next=14,D((function(){return fetch(o,d)}));case 14:if(!(f=e.sent).ok){e.next=23;break}return e.next=18,f.json();case 18:return p=e.sent,v={fid:p.fid||a,registrationStatus:2,refreshToken:p.refreshToken,authToken:x(p.authToken)},e.abrupt("return",v);case 23:return e.next=25,N("Create Installation",f);case 25:throw e.sent;case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return new Promise((function(t){setTimeout(t,e)}))}var F=/^[cdef][\w-]{21}$/,q="";function W(){try{var e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;var t=function(e){var t=(n=e,btoa(String.fromCharCode.apply(String,(0,v.Z)(n))).replace(/\+/g,"-").replace(/\//g,"_"));var n;return t.substr(0,22)}(e);return F.test(t)?t:q}catch(n){return q}}function j(e){return"".concat(e.appName,"!").concat(e.appId)}var U=new Map;function B(e,t){var n=j(e);H(n,t),function(e,t){var n=V();n&&n.postMessage({key:e,fid:t});K()}(n,t)}function H(e,t){var n=U.get(e);if(n){var r,i=(0,a.Z)(n);try{for(i.s();!(r=i.n()).done;){(0,r.value)(t)}}catch(o){i.e(o)}finally{i.f()}}}var z=null;function V(){return!z&&"BroadcastChannel"in self&&((z=new BroadcastChannel("[Firebase] FID Change")).onmessage=function(e){H(e.data.key,e.data.fid)}),z}function K(){0===U.size&&z&&(z.close(),z=null)}var Y="firebase-installations-database",G=1,$="firebase-installations-store",Q=null;function X(){return Q||(Q=(0,_.X3)(Y,G,{upgrade:function(e,t){if(0===t)e.createObjectStore($)}})),Q}function J(e,t){return ee.apply(this,arguments)}function ee(){return(ee=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r,i,a,o,s;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=j(t),e.next=3,X();case 3:return i=e.sent,a=i.transaction($,"readwrite"),o=a.objectStore($),e.next=8,o.get(r);case 8:return s=e.sent,e.next=11,o.put(n,r);case 11:return e.next=13,a.done;case 13:return s&&s.fid===n.fid||B(t,n.fid),e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return(ne=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=j(t),e.next=3,X();case 3:return r=e.sent,i=r.transaction($,"readwrite"),e.next=7,i.objectStore($).delete(n);case 7:return e.next=9,i.done;case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t){return ie.apply(this,arguments)}function ie(){return(ie=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r,i,a,o,s,u;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=j(t),e.next=3,X();case 3:return i=e.sent,a=i.transaction($,"readwrite"),o=a.objectStore($),e.next=8,o.get(r);case 8:if(s=e.sent,void 0!==(u=n(s))){e.next=15;break}return e.next=13,o.delete(r);case 13:e.next=17;break;case 15:return e.next=17,o.put(u,r);case 17:return e.next=19,a.done;case 19:return!u||s&&s.fid===u.fid||B(t,u.fid),e.abrupt("return",u);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return oe.apply(this,arguments)}function oe(){return(oe=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re(t.appConfig,(function(e){var r=se(e),i=ue(t,r);return n=i.registrationPromise,i.installationEntry}));case 2:if((r=e.sent).fid!==q){e.next=8;break}return e.next=6,n;case 6:return e.t0=e.sent,e.abrupt("return",{installationEntry:e.t0});case 8:return e.abrupt("return",{installationEntry:r,registrationPromise:n});case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e){return fe(e||{fid:W(),registrationStatus:0})}function ue(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(T.create("app-offline"))};var n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},r=function(e,t){return ce.apply(this,arguments)}(e,n);return{installationEntry:n,registrationPromise:r}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:le(e)}:{installationEntry:t}}function ce(){return(ce=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O(t,n);case 3:return r=e.sent,e.abrupt("return",J(t.appConfig,r));case 7:if(e.prev=7,e.t0=e.catch(0),!S(e.t0)||409!==e.t0.customData.serverCode){e.next=14;break}return e.next=12,te(t.appConfig);case 12:e.next=16;break;case 14:return e.next=16,J(t.appConfig,{fid:n.fid,registrationStatus:0});case 16:throw e.t0;case 17:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function le(e){return he.apply(this,arguments)}function he(){return(he=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r,i,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,de(t.appConfig);case 2:n=e.sent;case 3:if(1!==n.registrationStatus){e.next=11;break}return e.next=6,L(100);case 6:return e.next=8,de(t.appConfig);case 8:n=e.sent,e.next=3;break;case 11:if(0!==n.registrationStatus){e.next=22;break}return e.next=14,ae(t);case 14:if(r=e.sent,i=r.installationEntry,!(a=r.registrationPromise)){e.next=21;break}return e.abrupt("return",a);case 21:return e.abrupt("return",i);case 22:return e.abrupt("return",n);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function de(e){return re(e,(function(e){if(!e)throw T.create("installation-not-found");return fe(e)}))}function fe(e){return 1===(t=e).registrationStatus&&t.registrationTime+m<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}function pe(e,t){return ve.apply(this,arguments)}function ve(){return(ve=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r,i,a,o,s,u,l,h,d,f,p;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.appConfig,i=t.heartbeatServiceProvider,a=_e(r,n),o=P(r,n),!(s=i.getImmediate({optional:!0}))){e.next=9;break}return e.next=7,s.getHeartbeatsHeader();case 7:(u=e.sent)&&o.append("x-firebase-client",u);case 9:return l={installation:{sdkVersion:k,appId:r.appId}},h={method:"POST",headers:o,body:JSON.stringify(l)},e.next=13,D((function(){return fetch(a,h)}));case 13:if(!(d=e.sent).ok){e.next=22;break}return e.next=17,d.json();case 17:return f=e.sent,p=x(f),e.abrupt("return",p);case 22:return e.next=24,N("Generate Auth Token",d);case 24:throw e.sent;case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _e(e,t){var n=t.fid;return"".concat(E(e),"/").concat(n,"/authTokens:generate")}function ye(e){return ge.apply(this,arguments)}function ge(){return ge=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r,i,a,o=arguments;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],e.next=3,re(t.appConfig,(function(e){if(!Ie(e))throw T.create("not-registered");var i=e.authToken;if(!n&&Te(i))return e;if(1===i.requestStatus)return r=me(t,n),e;if(!navigator.onLine)throw T.create("app-offline");var a=Se(e);return r=we(t,a),a}));case 3:if(i=e.sent,!r){e.next=10;break}return e.next=7,r;case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=i.authToken;case 11:return a=e.t0,e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)}))),ge.apply(this,arguments)}function me(e,t){return ke.apply(this,arguments)}function ke(){return(ke=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,be(t.appConfig);case 2:r=e.sent;case 3:if(1!==r.authToken.requestStatus){e.next=11;break}return e.next=6,L(100);case 6:return e.next=8,be(t.appConfig);case 8:r=e.sent,e.next=3;break;case 11:if(0!==(i=r.authToken).requestStatus){e.next=16;break}return e.abrupt("return",ye(t,n));case 16:return e.abrupt("return",i);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){return re(e,(function(e){if(!Ie(e))throw T.create("not-registered");var t,n=e.authToken;return 1===(t=n).requestStatus&&t.requestTime+m<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e}))}function we(e,t){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,l.Z)((0,c.Z)().mark((function e(t,n){var r,i,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,pe(t,n);case 3:return r=e.sent,i=Object.assign(Object.assign({},n),{authToken:r}),e.next=7,J(t.appConfig,i);case 7:return e.abrupt("return",r);case 10:if(e.prev=10,e.t0=e.catch(0),!S(e.t0)||401!==e.t0.customData.serverCode&&404!==e.t0.customData.serverCode){e.next=17;break}return e.next=15,te(t.appConfig);case 15:e.next=20;break;case 17:return a=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),e.next=20,J(t.appConfig,a);case 20:throw e.t0;case 21:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function Ie(e){return void 0!==e&&2===e.registrationStatus}function Te(e){return 2===e.requestStatus&&!function(e){var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+C}(e)}function Se(e){var t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}function Ee(){return(Ee=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r,i,a;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,ae(n);case 3:return r=e.sent,i=r.installationEntry,(a=r.registrationPromise)?a.catch(console.error):ye(n).catch(console.error),e.abrupt("return",i.fid);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(){return xe=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r,i,a=arguments;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]&&a[1],r=t,e.next=4,Ne(r);case 4:return e.next=6,ye(r,n);case 6:return i=e.sent,e.abrupt("return",i.token);case 8:case"end":return e.stop()}}),e)}))),xe.apply(this,arguments)}function Ne(e){return Re.apply(this,arguments)}function Re(){return(Re=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ae(t);case 2:if(n=e.sent,!(r=n.registrationPromise)){e.next=7;break}return e.next=7,r;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ze(e){return T.create("missing-app-config-values",{valueName:e})}var Pe,De="installations",Ae="installations-internal",Oe=function(e){var t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Ze("App Configuration");if(!e.name)throw Ze("App Name");for(var t=0,n=["projectId","apiKey","appId"];t<n.length;t++){var r=n[t];if(!e.options[r])throw Ze(r)}return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:(0,h.qX)(t,"heartbeat"),_delete:function(){return Promise.resolve()}}},Me=function(e){var t=e.getProvider("app").getImmediate(),n=(0,h.qX)(t,De).getImmediate(),r={getId:function(){return function(e){return Ee.apply(this,arguments)}(n)},getToken:function(e){return function(e){return xe.apply(this,arguments)}(n,e)}};return r};(0,h.Xd)(new p.wA(De,Oe,"PUBLIC")),(0,h.Xd)(new p.wA(Ae,Me,"PRIVATE")),(0,h.KN)(y,g),(0,h.KN)(y,g,"esm2017");var Le="analytics",Fe="firebase_id",qe="origin",We=6e4,je="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ue="https://www.googletagmanager.com/gtag/js",Be=new d.Yd("@firebase/analytics");function He(e){return Promise.all(e.map((function(e){return e.catch((function(e){return e}))})))}function ze(e,t){var n=document.createElement("script");n.src="".concat(Ue,"?l=").concat(e,"&id=").concat(t),n.async=!0,document.head.appendChild(n)}function Ve(e,t,n,r,i,a){return Ke.apply(this,arguments)}function Ke(){return Ke=(0,l.Z)((0,c.Z)().mark((function e(t,n,r,i,a,o){var s,u,l;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i[a],e.prev=1,!s){e.next=7;break}return e.next=5,n[s];case 5:e.next=14;break;case 7:return e.next=9,He(r);case 9:if(u=e.sent,!(l=u.find((function(e){return e.measurementId===a})))){e.next=14;break}return e.next=14,n[l.appId];case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),Be.error(e.t0);case 19:t("config",a,o);case 20:case"end":return e.stop()}}),e,null,[[1,16]])}))),Ke.apply(this,arguments)}function Ye(e,t,n,r,i){return Ge.apply(this,arguments)}function Ge(){return Ge=(0,l.Z)((0,c.Z)().mark((function e(t,n,r,i,o){var s,u,l,h,d,f;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=[],!o||!o.send_to){e.next=27;break}return u=o.send_to,Array.isArray(u)||(u=[u]),e.next=7,He(r);case 7:l=e.sent,h=(0,a.Z)(u),e.prev=9,f=(0,c.Z)().mark((function e(){var t,r,i;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.value,r=l.find((function(e){return e.measurementId===t})),!(i=r&&n[r.appId])){e.next=7;break}s.push(i),e.next=9;break;case 7:return s=[],e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),h.s();case 12:if((d=h.n()).done){e.next=19;break}return e.delegateYield(f(),"t0",14);case 14:if("break"!==e.t0){e.next=17;break}return e.abrupt("break",19);case 17:e.next=12;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e.catch(9),h.e(e.t1);case 24:return e.prev=24,h.f(),e.finish(24);case 27:return 0===s.length&&(s=Object.values(n)),e.next=30,Promise.all(s);case 30:t("event",i,o||{}),e.next=36;break;case 33:e.prev=33,e.t2=e.catch(0),Be.error(e.t2);case 36:case"end":return e.stop()}}),e,null,[[0,33],[9,21,24,27]])}))),Ge.apply(this,arguments)}function $e(e,t,n,r,i){var a=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];window[r].push(arguments)};return window[i]&&"function"===typeof window[i]&&(a=window[i]),window[i]=function(e,t,n,r){function i(){return(i=(0,l.Z)((0,c.Z)().mark((function i(a,o,s){return(0,c.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,"event"!==a){i.next=6;break}return i.next=4,Ye(e,t,n,o,s);case 4:i.next=12;break;case 6:if("config"!==a){i.next=11;break}return i.next=9,Ve(e,t,n,r,o,s);case 9:i.next=12;break;case 11:"consent"===a?e("consent","update",s):e("set",o);case 12:i.next=17;break;case 14:i.prev=14,i.t0=i.catch(0),Be.error(i.t0);case 17:case"end":return i.stop()}}),i,null,[[0,14]])})))).apply(this,arguments)}return function(e,t,n){return i.apply(this,arguments)}}(a,e,t,n),{gtagCore:a,wrappedGtag:window[i]}}function Qe(e){for(var t=window.document.getElementsByTagName("script"),n=0,r=Object.values(t);n<r.length;n++){var i=r[n];if(i.src&&i.src.includes(Ue)&&i.src.includes(e))return i}return null}var Xe=(Pe={},(0,u.Z)(Pe,"already-exists","A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId."),(0,u.Z)(Pe,"already-initialized","initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance."),(0,u.Z)(Pe,"already-initialized-settings","Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect."),(0,u.Z)(Pe,"interop-component-reg-failed","Firebase Analytics Interop Component failed to instantiate: {$reason}"),(0,u.Z)(Pe,"invalid-analytics-context","Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}"),(0,u.Z)(Pe,"indexeddb-unavailable","IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}"),(0,u.Z)(Pe,"fetch-throttle","The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}."),(0,u.Z)(Pe,"config-fetch-failed","Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}"),(0,u.Z)(Pe,"no-api-key",'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.'),(0,u.Z)(Pe,"no-app-id",'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'),Pe),Je=new f.LL("analytics","Analytics",Xe),et=30,tt=1e3,nt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tt;(0,o.Z)(this,e),this.throttleMetadata=t,this.intervalMillis=n}return(0,s.Z)(e,[{key:"getThrottleMetadata",value:function(e){return this.throttleMetadata[e]}},{key:"setThrottleMetadata",value:function(e,t){this.throttleMetadata[e]=t}},{key:"deleteThrottleMetadata",value:function(e){delete this.throttleMetadata[e]}}]),e}(),rt=new nt;function it(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function at(e){return ot.apply(this,arguments)}function ot(){return(ot=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r,i,a,o,s,u,l;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.appId,i=t.apiKey,a={method:"GET",headers:it(i)},o=je.replace("{app-id}",r),e.next=5,fetch(o,a);case 5:if(200===(s=e.sent).status||304===s.status){e.next=18;break}return u="",e.prev=8,e.next=11,s.json();case 11:l=e.sent,(null===(n=l.error)||void 0===n?void 0:n.message)&&(u=l.error.message),e.next=17;break;case 15:e.prev=15,e.t0=e.catch(8);case 17:throw Je.create("config-fetch-failed",{httpStatus:s.status,responseMessage:u});case 18:return e.abrupt("return",s.json());case 19:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function st(e){return ut.apply(this,arguments)}function ut(){return ut=(0,l.Z)((0,c.Z)().mark((function e(t){var n,r,i,a,o,s,u,h,d=arguments;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=d.length>1&&void 0!==d[1]?d[1]:rt,r=d.length>2?d[2]:void 0,i=t.options,a=i.appId,o=i.apiKey,s=i.measurementId,a){e.next=5;break}throw Je.create("no-app-id");case 5:if(o){e.next=9;break}if(!s){e.next=8;break}return e.abrupt("return",{measurementId:s,appId:a});case 8:throw Je.create("no-api-key");case 9:return u=n.getThrottleMetadata(a)||{backoffCount:0,throttleEndTimeMillis:Date.now()},h=new vt,setTimeout((0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h.abort();case 1:case"end":return e.stop()}}),e)}))),void 0!==r?r:We),e.abrupt("return",ct({appId:a,apiKey:o,measurementId:s},u,h,n));case 13:case"end":return e.stop()}}),e)}))),ut.apply(this,arguments)}function ct(e,t,n){return lt.apply(this,arguments)}function lt(){return lt=(0,l.Z)((0,c.Z)().mark((function e(t,n,r){var i,a,o,s,u,l,h,d,p,v,_=arguments;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.throttleEndTimeMillis,a=n.backoffCount,o=_.length>3&&void 0!==_[3]?_[3]:rt,u=t.appId,l=t.measurementId,e.prev=3,e.next=6,ht(r,i);case 6:e.next=14;break;case 8:if(e.prev=8,e.t0=e.catch(3),!l){e.next=13;break}return Be.warn("Timed out fetching this Firebase app's measurement ID from the server."+" Falling back to the measurement ID ".concat(l)+' provided in the "measurementId" field in the local Firebase config. ['.concat(null===e.t0||void 0===e.t0?void 0:e.t0.message,"]")),e.abrupt("return",{appId:u,measurementId:l});case 13:throw e.t0;case 14:return e.prev=14,e.next=17,at(t);case 17:return h=e.sent,o.deleteThrottleMetadata(u),e.abrupt("return",h);case 22:if(e.prev=22,e.t1=e.catch(14),dt(d=e.t1)){e.next=33;break}if(o.deleteThrottleMetadata(u),!l){e.next=32;break}return Be.warn("Failed to fetch this Firebase app's measurement ID from the server."+" Falling back to the measurement ID ".concat(l)+' provided in the "measurementId" field in the local Firebase config. ['.concat(null===d||void 0===d?void 0:d.message,"]")),e.abrupt("return",{appId:u,measurementId:l});case 32:throw e.t1;case 33:return p=503===Number(null===(s=null===d||void 0===d?void 0:d.customData)||void 0===s?void 0:s.httpStatus)?(0,f.$s)(a,o.intervalMillis,et):(0,f.$s)(a,o.intervalMillis),v={throttleEndTimeMillis:Date.now()+p,backoffCount:a+1},o.setThrottleMetadata(u,v),Be.debug("Calling attemptFetch again in ".concat(p," millis")),e.abrupt("return",ct(t,v,r,o));case 38:case"end":return e.stop()}}),e,null,[[3,8],[14,22]])}))),lt.apply(this,arguments)}function ht(e,t){return new Promise((function(n,r){var i=Math.max(t-Date.now(),0),a=setTimeout(n,i);e.addEventListener((function(){clearTimeout(a),r(Je.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}function dt(e){if(!(e instanceof f.ZR)||!e.customData)return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}var ft,pt,vt=function(){function e(){(0,o.Z)(this,e),this.listeners=[]}return(0,s.Z)(e,[{key:"addEventListener",value:function(e){this.listeners.push(e)}},{key:"abort",value:function(){this.listeners.forEach((function(e){return e()}))}}]),e}();function _t(){return(_t=(0,l.Z)((0,c.Z)().mark((function e(t,n,r,i,a){var o,s;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a||!a.global){e.next=5;break}return t("event",r,i),e.abrupt("return");case 5:return e.next=7,n;case 7:o=e.sent,s=Object.assign(Object.assign({},i),{send_to:o}),t("event",r,s);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yt(e){pt=e}function gt(e){ft=e}function mt(){return kt.apply(this,arguments)}function kt(){return(kt=(0,l.Z)((0,c.Z)().mark((function e(){return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,f.hl)()){e.next=5;break}return Be.warn(Je.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),e.abrupt("return",!1);case 5:return e.prev=5,e.next=8,(0,f.eu)();case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(5),Be.warn(Je.create("indexeddb-unavailable",{errorInfo:null===e.t0||void 0===e.t0?void 0:e.t0.toString()}).message),e.abrupt("return",!1);case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,null,[[5,10]])})))).apply(this,arguments)}function bt(){return bt=(0,l.Z)((0,c.Z)().mark((function e(t,n,r,a,o,s,u){var l,h,d,f,p,v,_,y;return(0,c.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(h=st(t)).then((function(e){r[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Be.warn("The measurement ID in the local Firebase config (".concat(t.options.measurementId,")")+" does not match the measurement ID fetched from the server (".concat(e.measurementId,").")+" To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")})).catch((function(e){return Be.error(e)})),n.push(h),d=mt().then((function(e){return e?a.getId():void 0})),e.next=6,Promise.all([h,d]);case 6:return f=e.sent,p=(0,i.Z)(f,2),v=p[0],_=p[1],Qe(s)||ze(s,v.measurementId),pt&&(o("consent","default",pt),yt(void 0)),o("js",new Date),(y=null!==(l=null===u||void 0===u?void 0:u.config)&&void 0!==l?l:{})[qe]="firebase",y.update=!0,null!=_&&(y[Fe]=_),o("config",v.measurementId,y),ft&&(o("set",ft),gt(void 0)),e.abrupt("return",v.measurementId);case 20:case"end":return e.stop()}}),e)}))),bt.apply(this,arguments)}var wt,Ct,It=function(){function e(t){(0,o.Z)(this,e),this.app=t}return(0,s.Z)(e,[{key:"_delete",value:function(){return delete Tt[this.app.options.appId],Promise.resolve()}}]),e}(),Tt={},St=[],Et={},xt="dataLayer",Nt="gtag",Rt=!1;function Zt(e,t,n){!function(){var e=[];if((0,f.ru)()&&e.push("This is a browser extension environment."),(0,f.zI)()||e.push("Cookies are not available."),e.length>0){var t=e.map((function(e,t){return"(".concat(t+1,") ").concat(e)})).join(" "),n=Je.create("invalid-analytics-context",{errorInfo:t});Be.warn(n.message)}}();var r=e.options.appId;if(!r)throw Je.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Je.create("no-api-key");Be.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest'+" measurement ID for this Firebase app. Falling back to the measurement ID ".concat(e.options.measurementId)+' provided in the "measurementId" field in the local Firebase config.')}if(null!=Tt[r])throw Je.create("already-exists",{id:r});if(!Rt){!function(e){var t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(xt);var i=$e(Tt,St,Et,xt,Nt),a=i.wrappedGtag,o=i.gtagCore;Ct=a,wt=o,Rt=!0}return Tt[r]=function(e,t,n,r,i,a,o){return bt.apply(this,arguments)}(e,St,Et,t,wt,xt,n),new It(e)}function Pt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,h.Mq)();e=(0,f.m9)(e);var t=(0,h.qX)(e,Le);return t.isInitialized()?t.getImmediate():function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=(0,h.qX)(e,Le);if(n.isInitialized()){var r=n.getImmediate();if((0,f.vZ)(t,n.getOptions()))return r;throw Je.create("already-initialized")}var i=n.initialize({options:t});return i}(e)}function Dt(e,t,n,r){e=(0,f.m9)(e),function(e,t,n,r,i){return _t.apply(this,arguments)}(Ct,Tt[e.app.options.appId],t,n,r).catch((function(e){return Be.error(e)}))}var At="@firebase/analytics",Ot="0.9.3";(0,h.Xd)(new p.wA(Le,(function(e,t){var n=t.options;return Zt(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),n)}),"PUBLIC")),(0,h.Xd)(new p.wA("analytics-internal",(function(e){try{var t=e.getProvider(Le).getImmediate();return{logEvent:function(e,n,r){return Dt(t,e,n,r)}}}catch(n){throw Je.create("interop-component-reg-failed",{reason:n})}}),"PRIVATE")),(0,h.KN)(At,Ot),(0,h.KN)(At,Ot,"esm2017")},44702:function(e,t,n){n.d(t,{ZF:function(){return r.ZF}});var r=n(89474);(0,r.KN)("firebase","9.17.1","app")},72685:function(e,t,n){n.d(t,{N8:function(){return fi}});var r=n(74165),i=n(29439),a=n(15861),o=n(97326),s=n(60136),u=n(27277),c=n(93433),l=n(37762),h=n(15671),d=n(43144),f=n(89474),p=n(23258),v=n(85854),_=n(6781),y="@firebase/database",g="0.14.3",m="";var k=function(){function e(t){(0,h.Z)(this,e),this.domStorage_=t,this.prefix_="firebase:"}return(0,d.Z)(e,[{key:"set",value:function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,v.Wl)(t))}},{key:"get",value:function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,v.cI)(t)}},{key:"remove",value:function(e){this.domStorage_.removeItem(this.prefixedName_(e))}},{key:"prefixedName_",value:function(e){return this.prefix_+e}},{key:"toString",value:function(){return this.domStorage_.toString()}}]),e}(),b=function(){function e(){(0,h.Z)(this,e),this.cache_={},this.isInMemoryStorage=!0}return(0,d.Z)(e,[{key:"set",value:function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}},{key:"get",value:function(e){return(0,v.r3)(this.cache_,e)?this.cache_[e]:null}},{key:"remove",value:function(e){delete this.cache_[e]}}]),e}(),w=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new k(t)}}catch(n){}return new b},C=w("localStorage"),I=w("sessionStorage"),T=new _.Yd("@firebase/database"),S=function(){var e=1;return function(){return e++}}(),E=function(e){var t=(0,v.dS)(e),n=new v.gQ;n.update(t);var r=n.digest();return v.US.encodeByteArray(r)},x=function e(){for(var t="",n=0;n<arguments.length;n++){var r=n<0||arguments.length<=n?void 0:arguments[n];Array.isArray(r)||r&&"object"===typeof r&&"number"===typeof r.length?t+=e.apply(null,r):t+="object"===typeof r?(0,v.Wl)(r):r,t+=" "}return t},N=null,R=!0,Z=function(e,t){(0,v.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(T.logLevel=_.in.VERBOSE,N=T.log.bind(T),t&&I.set("logging_enabled",!0)):"function"===typeof e?N=e:(N=null,I.remove("logging_enabled"))},P=function(){if(!0===R&&(R=!1,null===N&&!0===I.get("logging_enabled")&&Z(!0)),N){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=x.apply(null,t);N(r)}},D=function(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];P.apply(void 0,[e].concat(n))}},A=function(){var e="FIREBASE INTERNAL ERROR: "+x.apply(void 0,arguments);T.error(e)},O=function(){var e="FIREBASE FATAL ERROR: ".concat(x.apply(void 0,arguments));throw T.error(e),new Error(e)},M=function(){var e="FIREBASE WARNING: "+x.apply(void 0,arguments);T.warn(e)},L=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},F="[MIN_NAME]",q="[MAX_NAME]",W=function(e,t){if(e===t)return 0;if(e===F||t===q)return-1;if(t===F||e===q)return 1;var n=Y(e),r=Y(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},j=function(e,t){return e===t?0:e<t?-1:1},U=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,v.Wl)(t))},B=function e(t){if("object"!==typeof t||null===t)return(0,v.Wl)(t);var n=[];for(var r in t)n.push(r);n.sort();for(var i="{",a=0;a<n.length;a++)0!==a&&(i+=","),i+=(0,v.Wl)(n[a]),i+=":",i+=e(t[n[a]]);return i+="}"},H=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function z(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var V=function(e){(0,v.hu)(!L(e),"Invalid JSON number");var t,n,r,i,a,o=1023;0===e?(n=0,r=0,t=1/e===-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),o))+o,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var s=[];for(a=52;a;a-=1)s.push(r%2?1:0),r=Math.floor(r/2);for(a=11;a;a-=1)s.push(n%2?1:0),n=Math.floor(n/2);s.push(t?1:0),s.reverse();var u=s.join(""),c="";for(a=0;a<64;a+=8){var l=parseInt(u.substr(a,8),2).toString(16);1===l.length&&(l="0"+l),c+=l}return c.toLowerCase()};var K=new RegExp("^-?(0*)\\d{1,10}$"),Y=function(e){if(K.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},G=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";throw M("Exception was thrown by user callback.",e),t}),Math.floor(0))}},$=function(){return("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Q=function(e,t){var n=setTimeout(e,t);return"number"===typeof n&&"undefined"!==typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"===typeof n&&n.unref&&n.unref(),n},X=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.appName_=t,this.appCheckProvider=n,this.appCheck=null===n||void 0===n?void 0:n.getImmediate({optional:!0}),this.appCheck||null===n||void 0===n||n.get().then((function(e){return r.appCheck=e}))}return(0,d.Z)(e,[{key:"getToken",value:function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))}},{key:"addTokenChangeListener",value:function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((function(t){return t.addTokenListener(e)}))}},{key:"notifyForInvalidToken",value:function(){M('Provided AppCheck credentials for the app named "'.concat(this.appName_,'" ')+"are invalid. This usually indicates your app was not initialized correctly.")}}]),e}(),J=function(){function e(t,n,r){var i=this;(0,h.Z)(this,e),this.appName_=t,this.firebaseOptions_=n,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit((function(e){return i.auth_=e}))}return(0,d.Z)(e,[{key:"getToken",value:function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(P("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))}},{key:"addTokenChangeListener",value:function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))}},{key:"removeTokenChangeListener",value:function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))}},{key:"notifyForInvalidToken",value:function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',M(e)}}]),e}(),ee=function(){function e(t){(0,h.Z)(this,e),this.accessToken=t}return(0,d.Z)(e,[{key:"getToken",value:function(e){return Promise.resolve({accessToken:this.accessToken})}},{key:"addTokenChangeListener",value:function(e){e(this.accessToken)}},{key:"removeTokenChangeListener",value:function(e){}},{key:"notifyForInvalidToken",value:function(){}}]),e}();ee.OWNER="owner";var te="5",ne=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,re="ac",ie="websocket",ae="long_polling",oe=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7];(0,h.Z)(this,e),this.secure=n,this.namespace=r,this.webSocketOnly=i,this.nodeAdmin=a,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this.isUsingEmulator=u,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=C.get("host:"+t)||this._host}return(0,d.Z)(e,[{key:"isCacheableHost",value:function(){return"s-"===this.internalHost.substr(0,2)}},{key:"isCustomHost",value:function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}},{key:"host",get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&C.set("host:"+this._host,this.internalHost))}},{key:"toString",value:function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}},{key:"toURLString",value:function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns=".concat(this.namespace):"";return"".concat(e).concat(this.host,"/").concat(t)}}]),e}();function se(e,t,n){var r;if((0,v.hu)("string"===typeof t,"typeof type must == string"),(0,v.hu)("object"===typeof n,"typeof params must == object"),t===ie)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==ae)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var i=[];return z(n,(function(e,t){i.push(e+"="+t)})),r+i.join("&")}var ue=function(){function e(){(0,h.Z)(this,e),this.counters_={}}return(0,d.Z)(e,[{key:"incrementCounter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;(0,v.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}},{key:"get",value:function(){return(0,v.p$)(this.counters_)}}]),e}(),ce={},le={};function he(e){var t=e.toString();return ce[t]||(ce[t]=new ue),ce[t]}var de=function(){function e(t){(0,h.Z)(this,e),this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return(0,d.Z)(e,[{key:"closeAfter",value:function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}},{key:"handleResponse",value:function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=n.pendingResponses[n.currentResponseNum];delete n.pendingResponses[n.currentResponseNum];for(var t=function(t){e[t]&&G((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(n.currentResponseNum===n.closeAfterResponse)return n.onClose&&(n.onClose(),n.onClose=null),"break";n.currentResponseNum++};this.pendingResponses[this.currentResponseNum];){if("break"===r())break}}}]),e}(),fe="start",pe="close",ve="pLPCommand",_e="pRTLPCB",ye=function(){function e(t,n,r,i,a,o,s){var u=this;(0,h.Z)(this,e),this.connId=t,this.repoInfo=n,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=D(t),this.stats_=he(n),this.urlFn=function(e){return u.appCheckToken&&(e[re]=u.appCheckToken),se(n,ae,e)}}return(0,d.Z)(e,[{key:"open",value:function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new de(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if((0,v.Yr)()||"complete"===document.readyState)e();else{var t=!1,n=function n(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new ge((function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],a=t[1],o=t[2];t[3],t[4];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===fe)n.id=a,n.password=o;else{if(i!==pe)throw new Error("Unrecognized command received: "+i);a?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(a,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],a=t[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,a)}),(function(){n.onClosed_()}),n.urlFn);var e={};e[fe]="t",e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v=te,n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e[re]=n.appCheckToken),"undefined"!==typeof location&&location.hostname&&ne.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))}},{key:"start",value:function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}},{key:"markConnectionHealthy",value:function(){}},{key:"shutdown_",value:function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}},{key:"onClosed_",value:function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}},{key:"close",value:function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}},{key:"send",value:function(e){var t=(0,v.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=(0,v.h$)(t),r=H(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++}},{key:"addDisconnectPingFrame",value:function(e,t){if(!(0,v.Yr)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}}},{key:"incrementIncomingBytes_",value:function(e){var t=(0,v.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}],[{key:"forceAllow",value:function(){e.forceAllow_=!0}},{key:"forceDisallow",value:function(){e.forceDisallow_=!0}},{key:"isAvailable",value:function(){return!(0,v.Yr)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))}}]),e}(),ge=function(){function e(t,n,r,i){if((0,h.Z)(this,e),this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,v.Yr)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=S(),window[ve+this.uniqueCallbackIdentifier]=t,window[_e+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var a="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))a='<script>document.domain="'+document.domain+'";<\/script>';var o="<html><body>"+a+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(s){P("frame writing exception"),s.stack&&P(s.stack),P(s)}}}return(0,d.Z)(e,[{key:"close",value:function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())}},{key:"startLongPoll",value:function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}},{key:"newRequest_",value:function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}},{key:"enqueueSegment",value:function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}},{key:"addLongPollTag_",value:function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))}},{key:"addTag",value:function(e,t){var n=this;(0,v.Yr)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){P("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}}),Math.floor(1))}}],[{key:"createIFrame_",value:function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||P("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}}]),e}(),me=null;"undefined"!==typeof MozWebSocket?me=MozWebSocket:"undefined"!==typeof WebSocket&&(me=WebSocket);var ke=function(){function e(t,n,r,i,a,o,s){(0,h.Z)(this,e),this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=D(this.connId),this.stats_=he(n),this.connURL=e.connectionURL_(n,o,s,i,r),this.nodeAdmin=n.nodeAdmin}return(0,d.Z)(e,[{key:"open",value:function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,C.set("previous_websocket_failure",!0);try{var r;if((0,v.Yr)()){var i=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":"Firebase/".concat(te,"/").concat(m,"/").concat(process.platform,"/").concat(i),"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization="Bearer ".concat(this.authToken)),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);var a={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0},o=0===this.connURL.indexOf("wss://")?a.HTTPS_PROXY||a.https_proxy:a.HTTP_PROXY||a.http_proxy;o&&(r.proxy={origin:o})}this.mySock=new me(this.connURL,[],r)}catch(u){this.log_("Error instantiating WebSocket.");var s=u.message||u.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}}},{key:"start",value:function(){}},{key:"markConnectionHealthy",value:function(){C.remove("previous_websocket_failure")}},{key:"appendFrame_",value:function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=(0,v.cI)(t);this.onMessage(n)}}},{key:"handleNewFrameCount_",value:function(e){this.totalFrames=e,this.frames=[]}},{key:"extractFrameCount_",value:function(e){if((0,v.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}},{key:"handleIncomingFrame",value:function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}}},{key:"send",value:function(e){this.resetKeepAlive();var t=(0,v.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=H(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])}},{key:"shutdown_",value:function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}},{key:"onClosed_",value:function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}},{key:"close",value:function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}},{key:"resetKeepAlive",value:function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))}},{key:"sendString_",value:function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}],[{key:"connectionURL_",value:function(e,t,n,r,i){var a={};return a.v=te,!(0,v.Yr)()&&"undefined"!==typeof location&&location.hostname&&ne.test(location.hostname)&&(a.r="f"),t&&(a.s=t),n&&(a.ls=n),r&&(a[re]=r),i&&(a.p=i),se(e,ie,a)}},{key:"forceDisallow",value:function(){e.forceDisallow_=!0}},{key:"isAvailable",value:function(){var t=!1;if("undefined"!==typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==me&&!e.forceDisallow_}},{key:"previouslyFailed",value:function(){return C.isInMemoryStorage||!0===C.get("previous_websocket_failure")}}]),e}();ke.responsesRequiredToBeHealthy=2,ke.healthyTimeout=3e4;var be=function(){function e(t){(0,h.Z)(this,e),this.initTransports_(t)}return(0,d.Z)(e,[{key:"initTransports_",value:function(t){var n=ke&&ke.isAvailable(),r=n&&!ke.previouslyFailed();if(t.webSocketOnly&&(n||M("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[ke];else{var i,a=this.transports_=[],o=(0,l.Z)(e.ALL_TRANSPORTS);try{for(o.s();!(i=o.n()).done;){var s=i.value;s&&s.isAvailable()&&a.push(s)}}catch(u){o.e(u)}finally{o.f()}e.globalTransportInitialized_=!0}}},{key:"initialTransport",value:function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}},{key:"upgradeTransport",value:function(){return this.transports_.length>1?this.transports_[1]:null}}],[{key:"ALL_TRANSPORTS",get:function(){return[ye,ke]}},{key:"IS_TRANSPORT_INITIALIZED",get:function(){return this.globalTransportInitialized_}}]),e}();be.globalTransportInitialized_=!1;var we=function(){function e(t,n,r,i,a,o,s,u,c,l){(0,h.Z)(this,e),this.id=t,this.repoInfo_=n,this.applicationId_=r,this.appCheckToken_=i,this.authToken_=a,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=u,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=D("c:"+this.id+":"),this.transportManager_=new be(n),this.log_("Connection created"),this.start_()}return(0,d.Z)(e,[{key:"start_",value:function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=Q((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))}},{key:"nextTransportId_",value:function(){return"c:"+this.id+":"+this.connectionCount++}},{key:"disconnReceiver_",value:function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}}},{key:"connReceiver_",value:function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}}},{key:"sendRequest",value:function(e){var t={t:"d",d:e};this.sendData_(t)}},{key:"tryCleanupConnection",value:function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}},{key:"onSecondaryControl_",value:function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}},{key:"onSecondaryMessageReceived_",value:function(e){var t=U("t",e),n=U("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}},{key:"upgradeIfSecondaryHealthy_",value:function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}},{key:"proceedWithUpgrade_",value:function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}},{key:"onPrimaryMessageReceived_",value:function(e){var t=U("t",e),n=U("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}},{key:"onDataMessage_",value:function(e){this.onPrimaryResponse_(),this.onMessage_(e)}},{key:"onPrimaryResponse_",value:function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}},{key:"onControl_",value:function(e){var t=U("t",e);if("d"in e){var n=e.d;if("h"===t){var r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?A("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):A("Unknown control packet command: "+t)}}},{key:"onHandshake_",value:function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),te!==n&&M("Protocol version mismatch detected"),this.tryStartUpgrade_())}},{key:"tryStartUpgrade_",value:function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}},{key:"startUpgrade_",value:function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),Q((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))}},{key:"onReset_",value:function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}},{key:"onConnectionEstablished_",value:function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Q((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}},{key:"sendPingOnPrimaryIfNecessary_",value:function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}},{key:"onSecondaryConnectionLost_",value:function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}},{key:"onConnectionLost_",value:function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(C.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}},{key:"onConnectionShutdown_",value:function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}},{key:"sendData_",value:function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}},{key:"close",value:function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}},{key:"closeConnections_",value:function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}]),e}(),Ce=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"put",value:function(e,t,n,r){}},{key:"merge",value:function(e,t,n,r){}},{key:"refreshAuthToken",value:function(e){}},{key:"refreshAppCheckToken",value:function(e){}},{key:"onDisconnectPut",value:function(e,t,n){}},{key:"onDisconnectMerge",value:function(e,t,n){}},{key:"onDisconnectCancel",value:function(e,t){}},{key:"reportStats",value:function(e){}}]),e}(),Ie=function(){function e(t){(0,h.Z)(this,e),this.allowedEvents_=t,this.listeners_={},(0,v.hu)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return(0,d.Z)(e,[{key:"trigger",value:function(e){if(Array.isArray(this.listeners_[e])){for(var t=(0,c.Z)(this.listeners_[e]),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0;a<t.length;a++)t[a].callback.apply(t[a].context,r)}}},{key:"on",value:function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)}},{key:"off",value:function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)}},{key:"validateEventType_",value:function(e){(0,v.hu)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)}}]),e}(),Te=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e;return(0,h.Z)(this,n),(e=t.call(this,["online"])).online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||(0,v.uI)()||(window.addEventListener("online",(function(){e.online_||(e.online_=!0,e.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){e.online_&&(e.online_=!1,e.trigger("online",!1))}),!1)),e}return(0,d.Z)(n,[{key:"getInitialEvent",value:function(e){return(0,v.hu)("online"===e,"Unknown event type: "+e),[this.online_]}},{key:"currentlyOnline",value:function(){return this.online_}}],[{key:"getInstance",value:function(){return new n}}]),n}(Ie),Se=32,Ee=768,xe=function(){function e(t,n){if((0,h.Z)(this,e),void 0===n){this.pieces_=t.split("/");for(var r=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[r]=this.pieces_[i],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=n}return(0,d.Z)(e,[{key:"toString",value:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}]),e}();function Ne(){return new xe("")}function Re(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Ze(e){return e.pieces_.length-e.pieceNum_}function Pe(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new xe(e.pieces_,t)}function De(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.pieces_.slice(e.pieceNum_+t)}function Oe(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new xe(t,0)}function Me(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof xe)for(var i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);else for(var a=t.split("/"),o=0;o<a.length;o++)a[o].length>0&&n.push(a[o]);return new xe(n,0)}function Le(e){return e.pieceNum_>=e.pieces_.length}function Fe(e,t){var n=Re(e),r=Re(t);if(null===n)return t;if(n===r)return Fe(Pe(e),Pe(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function qe(e,t){if(Ze(e)!==Ze(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function We(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(Ze(e)>Ze(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var je=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.errorPrefix_=n,this.parts_=Ae(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(var r=0;r<this.parts_.length;r++)this.byteLength_+=(0,v.ug)(this.parts_[r]);Ue(this)}));function Ue(e){if(e.byteLength_>Ee)throw new Error(e.errorPrefix_+"has a key path longer than "+Ee+" bytes ("+e.byteLength_+").");if(e.parts_.length>Se)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Se+") or object contains a cycle "+Be(e))}function Be(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var He=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){var e,r,i;return(0,h.Z)(this,n),e=t.call(this,["visible"]),"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(i="visibilitychange",r="hidden"):"undefined"!==typeof document.mozHidden?(i="mozvisibilitychange",r="mozHidden"):"undefined"!==typeof document.msHidden?(i="msvisibilitychange",r="msHidden"):"undefined"!==typeof document.webkitHidden&&(i="webkitvisibilitychange",r="webkitHidden")),e.visible_=!0,i&&document.addEventListener(i,(function(){var t=!document[r];t!==e.visible_&&(e.visible_=t,e.trigger("visible",t))}),!1),e}return(0,d.Z)(n,[{key:"getInitialEvent",value:function(e){return(0,v.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}],[{key:"getInstance",value:function(){return new n}}]),n}(Ie),ze=1e3,Ve=3e5,Ke=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a,s,u,c,l){var d;if((0,h.Z)(this,n),(d=t.call(this)).repoInfo_=e,d.applicationId_=r,d.onDataUpdate_=i,d.onConnectStatus_=a,d.onServerInfoUpdate_=s,d.authTokenProvider_=u,d.appCheckTokenProvider_=c,d.authOverride_=l,d.id=n.nextPersistentConnectionId_++,d.log_=D("p:"+d.id+":"),d.interruptReasons_={},d.listens=new Map,d.outstandingPuts_=[],d.outstandingGets_=[],d.outstandingPutCount_=0,d.outstandingGetCount_=0,d.onDisconnectRequestQueue_=[],d.connected_=!1,d.reconnectDelay_=ze,d.maxReconnectDelay_=Ve,d.securityDebugCallback_=null,d.lastSessionId=null,d.establishConnectionTimer_=null,d.visible_=!1,d.requestCBHash_={},d.requestNumber_=0,d.realtime_=null,d.authToken_=null,d.appCheckToken_=null,d.forceTokenRefresh_=!1,d.invalidAuthTokenCount_=0,d.invalidAppCheckTokenCount_=0,d.firstConnection_=!0,d.lastConnectionAttemptTime_=null,d.lastConnectionEstablishedTime_=null,l&&!(0,v.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return He.getInstance().on("visible",d.onVisible_,(0,o.Z)(d)),-1===e.host.indexOf("fblocal")&&Te.getInstance().on("online",d.onOnline_,(0,o.Z)(d)),d}return(0,d.Z)(n,[{key:"sendRequest",value:function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_((0,v.Wl)(i)),(0,v.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}},{key:"get",value:function(e){this.initConnection_();var t=new v.BH,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:function(e){var n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;var r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}},{key:"listen",value:function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+i),this.listens.has(a)||this.listens.set(a,new Map),(0,v.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,v.hu)(!this.listens.get(a).has(i),"listen() called twice for same path/queryId.");var o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(a).set(i,o),this.connected_&&this.sendListen_(o)}},{key:"sendGet_",value:function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))}},{key:"sendListen_",value:function(e){var t=this,r=e.query,i=r._path.toString(),a=r._queryIdentifier;this.log_("Listen on "+i+" for "+a);var o={p:i};e.tag&&(o.q=r._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(function(o){var s=o.d,u=o.s;n.warnOnListenWarnings_(s,r),(t.listens.get(i)&&t.listens.get(i).get(a))===e&&(t.log_("listen response",o),"ok"!==u&&t.removeListen_(i,a),e.onComplete&&e.onComplete(u,s))}))}},{key:"refreshAuthToken",value:function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)}},{key:"reduceReconnectDelayIfAdminCredential_",value:function(e){(e&&40===e.length||(0,v.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}},{key:"refreshAppCheckToken",value:function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))}},{key:"tryAuth",value:function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=(0,v.w9)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"===typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}}},{key:"tryAppCheck",value:function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)}))}},{key:"unlisten",value:function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,v.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}},{key:"sendUnlisten_",value:function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}},{key:"onDisconnectPut",value:function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}},{key:"onDisconnectMerge",value:function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}},{key:"onDisconnectCancel",value:function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}},{key:"sendOnDisconnect_",value:function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))}},{key:"put",value:function(e,t,n,r){this.putInternal("p",e,t,n,r)}},{key:"merge",value:function(e,t,n,r){this.putInternal("m",e,t,n,r)}},{key:"putInternal",value:function(e,t,n,r,i){this.initConnection_();var a={p:t,d:n};void 0!==i&&(a.h=i),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}},{key:"sendPut_",value:function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))}},{key:"reportStats",value:function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}}},{key:"onDataMessage_",value:function(e){if("r"in e){this.log_("from server: "+(0,v.Wl)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}},{key:"onDataPush_",value:function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):A("Unrecognized action received from server: "+(0,v.Wl)(e)+"\nAre you using the latest client?")}},{key:"onReady_",value:function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}},{key:"scheduleConnect_",value:function(e){var t=this;(0,v.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))}},{key:"initConnection_",value:function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}},{key:"onVisible_",value:function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}},{key:"onOnline_",value:function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}},{key:"onRealtimeDisconnect_",value:function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=ze),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}},{key:"establishConnection_",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,a,o,s,u,c,l,h,d,f,p,_,y,g,m=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldReconnect_()){e.next=30;break}return this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,t=this.onDataMessage_.bind(this),a=this.onReady_.bind(this),o=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,u=this.lastSessionId,c=!1,l=null,h=function(){l?l.close():(c=!0,o())},d=function(e){(0,v.hu)(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(e)},this.realtime_={close:h,sendRequest:d},f=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,e.prev=16,e.next=19,Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);case 19:p=e.sent,_=(0,i.Z)(p,2),y=_[0],g=_[1],c?P("getToken() completed but was canceled"):(P("getToken() completed. Creating connection."),this.authToken_=y&&y.accessToken,this.appCheckToken_=g&&g.token,l=new we(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,a,o,(function(e){M(e+" ("+m.repoInfo_.toString()+")"),m.interrupt("server_kill")}),u)),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(16),this.log_("Failed to get token: "+e.t0),c||(this.repoInfo_.nodeAdmin&&M(e.t0),h());case 30:case"end":return e.stop()}}),e,this,[[16,26]])})));return function(){return e.apply(this,arguments)}}()},{key:"interrupt",value:function(e){P("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}},{key:"resume",value:function(e){P("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,v.xb)(this.interruptReasons_)&&(this.reconnectDelay_=ze,this.realtime_||this.scheduleConnect_(0))}},{key:"handleTimestamp_",value:function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}},{key:"cancelSentTransactions_",value:function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}},{key:"onListenRevoked_",value:function(e,t){var n;n=t?t.map((function(e){return B(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}},{key:"removeListen_",value:function(e,t){var n,r=new xe(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n}},{key:"onAuthRevoked_",value:function(e,t){P("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}},{key:"onAppCheckRevoked_",value:function(e,t){P("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}},{key:"onSecurityDebugPacket_",value:function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}},{key:"restoreState_",value:function(){this.tryAuth(),this.tryAppCheck();var e,t=(0,l.Z)(this.listens.values());try{for(t.s();!(e=t.n()).done;){var n,r=e.value,i=(0,l.Z)(r.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;this.sendListen_(a)}}catch(c){i.e(c)}finally{i.f()}}}catch(c){t.e(c)}finally{t.f()}for(var o=0;o<this.outstandingPuts_.length;o++)this.outstandingPuts_[o]&&this.sendPut_(o);for(;this.onDisconnectRequestQueue_.length;){var s=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(s.action,s.pathString,s.data,s.onComplete)}for(var u=0;u<this.outstandingGets_.length;u++)this.outstandingGets_[u]&&this.sendGet_(u)}},{key:"sendConnectStats_",value:function(){var e={},t="js";(0,v.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+m.replace(/\./g,"-")]=1,(0,v.uI)()?e["framework.cordova"]=1:(0,v.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}},{key:"shouldReconnect_",value:function(){var e=Te.getInstance().currentlyOnline();return(0,v.xb)(this.interruptReasons_)&&e}}],[{key:"warnOnListenWarnings_",value:function(e,t){if(e&&"object"===typeof e&&(0,v.r3)(e,"w")){var n=(0,v.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();M("Using an unspecified index. Your data will be downloaded and "+"filtered on the client. Consider adding ".concat(r," at ")+"".concat(i," to your security rules for better performance."))}}}}]),n}(Ce);Ke.nextPersistentConnectionId_=0,Ke.nextConnectionId_=0;var Ye,Ge=function(){function e(t,n){(0,h.Z)(this,e),this.name=t,this.node=n}return(0,d.Z)(e,null,[{key:"Wrap",value:function(t,n){return new e(t,n)}}]),e}(),$e=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"getCompare",value:function(){return this.compare.bind(this)}},{key:"indexedValueChanged",value:function(e,t){var n=new Ge(F,e),r=new Ge(F,t);return 0!==this.compare(n,r)}},{key:"minPost",value:function(){return Ge.MIN}}]),e}(),Qe=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"compare",value:function(e,t){return W(e.name,t.name)}},{key:"isDefinedOn",value:function(e){throw(0,v.g5)("KeyIndex.isDefinedOn not expected to be called.")}},{key:"indexedValueChanged",value:function(e,t){return!1}},{key:"minPost",value:function(){return Ge.MIN}},{key:"maxPost",value:function(){return new Ge(q,Ye)}},{key:"makePost",value:function(e,t){return(0,v.hu)("string"===typeof e,"KeyIndex indexValue must always be a string."),new Ge(e,Ye)}},{key:"toString",value:function(){return".key"}}],[{key:"__EMPTY_NODE",get:function(){return Ye},set:function(e){Ye=e}}]),n}($e),Xe=new Qe,Je=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;(0,h.Z)(this,e),this.isReverse_=i,this.resultGenerator_=a,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return(0,d.Z)(e,[{key:"getNext",value:function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}},{key:"hasNext",value:function(){return this.nodeStack_.length>0}},{key:"peek",value:function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}]),e}(),et=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:rt.EMPTY_NODE,this.right=null!=a?a:rt.EMPTY_NODE}return(0,d.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"count",value:function(){return this.left.count()+1+this.right.count()}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min_",value:function(){return this.left.isEmpty()?this:this.left.min_()}},{key:"minKey",value:function(){return this.min_().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}},{key:"removeMin_",value:function(){if(this.left.isEmpty())return rt.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}},{key:"remove",value:function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return rt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}},{key:"isRed_",value:function(){return this.color}},{key:"fixUp_",value:function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}},{key:"moveRedLeft_",value:function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}},{key:"moveRedRight_",value:function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}},{key:"rotateLeft_",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight_",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip_",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth_",value:function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1}},{key:"check_",value:function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}]),e}();et.RED=!0,et.BLACK=!1;var tt,nt=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new et(e,t,null)}},{key:"remove",value:function(e,t){return this}},{key:"count",value:function(){return 0}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"check_",value:function(){return 0}},{key:"isRed_",value:function(){return!1}}]),e}(),rt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.EMPTY_NODE;(0,h.Z)(this,e),this.comparator_=t,this.root_=n}return(0,d.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,et.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,et.BLACK,null,null))}},{key:"get",value:function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}},{key:"getPredecessorKey",value:function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}},{key:"isEmpty",value:function(){return this.root_.isEmpty()}},{key:"count",value:function(){return this.root_.count()}},{key:"minKey",value:function(){return this.root_.minKey()}},{key:"maxKey",value:function(){return this.root_.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root_.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.root_.reverseTraversal(e)}},{key:"getIterator",value:function(e){return new Je(this.root_,null,this.comparator_,!1,e)}},{key:"getIteratorFrom",value:function(e,t){return new Je(this.root_,e,this.comparator_,!1,t)}},{key:"getReverseIteratorFrom",value:function(e,t){return new Je(this.root_,e,this.comparator_,!0,t)}},{key:"getReverseIterator",value:function(e){return new Je(this.root_,null,this.comparator_,!0,e)}}]),e}();function it(e,t){return W(e.name,t.name)}function at(e,t){return W(e,t)}rt.EMPTY_NODE=new nt;var ot,st,ut,ct=function(e){return"number"===typeof e?"number:"+V(e):"string:"+e},lt=function(e){if(e.isLeafNode()){var t=e.val();(0,v.hu)("string"===typeof t||"number"===typeof t||"object"===typeof t&&(0,v.r3)(t,".sv"),"Priority must be a string or number.")}else(0,v.hu)(e===tt||e.isEmpty(),"priority of unexpected type.");(0,v.hu)(e===tt||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},ht=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.__childrenNodeConstructor.EMPTY_NODE;(0,h.Z)(this,e),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,(0,v.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),lt(this.priorityNode_)}return(0,d.Z)(e,[{key:"isLeafNode",value:function(){return!0}},{key:"getPriority",value:function(){return this.priorityNode_}},{key:"updatePriority",value:function(t){return new e(this.value_,t)}},{key:"getImmediateChild",value:function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}},{key:"getChild",value:function(t){return Le(t)?this:".priority"===Re(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE}},{key:"hasChild",value:function(){return!1}},{key:"getPredecessorChildName",value:function(e,t){return null}},{key:"updateImmediateChild",value:function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)}},{key:"updateChild",value:function(t,n){var r=Re(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:((0,v.hu)(".priority"!==r||1===Ze(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(Pe(t),n)))}},{key:"isEmpty",value:function(){return!1}},{key:"numChildren",value:function(){return 0}},{key:"forEachChild",value:function(e,t){return!1}},{key:"val",value:function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}},{key:"hash",value:function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+ct(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?V(this.value_):this.value_,this.lazyHash_=E(e)}return this.lazyHash_}},{key:"getValue",value:function(){return this.value_}},{key:"compareTo",value:function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:((0,v.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}},{key:"compareToLeafNode_",value:function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),a=e.VALUE_TYPE_ORDER.indexOf(r);return(0,v.hu)(i>=0,"Unknown leaf type: "+n),(0,v.hu)(a>=0,"Unknown leaf type: "+r),i===a?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:a-i}},{key:"withIndex",value:function(){return this}},{key:"isIndexed",value:function(){return!0}},{key:"equals",value:function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}],[{key:"__childrenNodeConstructor",get:function(){return ot},set:function(e){ot=e}}]),e}();ht.VALUE_TYPE_ORDER=["object","boolean","number","string"];var dt,ft,pt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"compare",value:function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?W(e.name,t.name):i}},{key:"isDefinedOn",value:function(e){return!e.getPriority().isEmpty()}},{key:"indexedValueChanged",value:function(e,t){return!e.getPriority().equals(t.getPriority())}},{key:"minPost",value:function(){return Ge.MIN}},{key:"maxPost",value:function(){return new Ge(q,new ht("[PRIORITY-POST]",ut))}},{key:"makePost",value:function(e,t){var n=st(e);return new Ge(t,new ht("[PRIORITY-POST]",n))}},{key:"toString",value:function(){return".priority"}}]),n}($e),vt=new pt,_t=Math.log(2),yt=function(){function e(t){(0,h.Z)(this,e);var n;this.count=(n=t+1,parseInt(Math.log(n)/_t,10)),this.current_=this.count-1;var r,i=(r=this.count,parseInt(Array(r+1).join("1"),2));this.bits_=t+1&i}return(0,d.Z)(e,[{key:"nextBitIsOne",value:function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e}}]),e}(),gt=function(e,t,n,r){e.sort(t);var i=function t(r,i){var a,o,s=i-r;if(0===s)return null;if(1===s)return a=e[r],o=n?n(a):a,new et(o,a.node,et.BLACK,null,null);var u=parseInt(s/2,10)+r,c=t(r,u),l=t(u+1,i);return a=e[u],o=n?n(a):a,new et(o,a.node,et.BLACK,c,l)},a=function(t){for(var r=null,a=null,o=e.length,s=function(t,r){var a=o-t,s=o;o-=t;var c=i(a+1,s),l=e[a],h=n?n(l):l;u(new et(h,l.node,r,null,c))},u=function(e){r?(r.left=e,r=e):(a=e,r=e)},c=0;c<t.count;++c){var l=t.nextBitIsOne(),h=Math.pow(2,t.count-(c+1));l?s(h,et.BLACK):(s(h,et.BLACK),s(h,et.RED))}return a}(new yt(e.length));return new rt(r||t,a)},mt={},kt=function(){function e(t,n){(0,h.Z)(this,e),this.indexes_=t,this.indexSet_=n}return(0,d.Z)(e,[{key:"get",value:function(e){var t=(0,v.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof rt?t:null}},{key:"hasIndex",value:function(e){return(0,v.r3)(this.indexSet_,e.toString())}},{key:"addIndex",value:function(t,n){(0,v.hu)(t!==Xe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],a=!1,o=n.getIterator(Ge.Wrap),s=o.getNext();s;)a=a||t.isDefinedOn(s.node),i.push(s),s=o.getNext();r=a?gt(i,t.getCompare()):mt;var u=t.toString(),c=Object.assign({},this.indexSet_);c[u]=t;var l=Object.assign({},this.indexes_);return l[u]=r,new e(l,c)}},{key:"addToIndexes",value:function(t,n){var r=this;return new e((0,v.UI)(this.indexes_,(function(e,i){var a=(0,v.DV)(r.indexSet_,i);if((0,v.hu)(a,"Missing index implementation for "+i),e===mt){if(a.isDefinedOn(t.node)){for(var o=[],s=n.getIterator(Ge.Wrap),u=s.getNext();u;)u.name!==t.name&&o.push(u),u=s.getNext();return o.push(t),gt(o,a.getCompare())}return mt}var c=n.get(t.name),l=e;return c&&(l=l.remove(new Ge(t.name,c))),l.insert(t,t.node)})),this.indexSet_)}},{key:"removeFromIndexes",value:function(t,n){return new e((0,v.UI)(this.indexes_,(function(e){if(e===mt)return e;var r=n.get(t.name);return r?e.remove(new Ge(t.name,r)):e})),this.indexSet_)}}],[{key:"Default",get:function(){return(0,v.hu)(mt&&vt,"ChildrenNode.ts has not been loaded"),dt=dt||new e({".priority":mt},{".priority":vt})}}]),e}(),bt=function(){function e(t,n,r){(0,h.Z)(this,e),this.children_=t,this.priorityNode_=n,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&lt(this.priorityNode_),this.children_.isEmpty()&&(0,v.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return(0,d.Z)(e,[{key:"isLeafNode",value:function(){return!1}},{key:"getPriority",value:function(){return this.priorityNode_||ft}},{key:"updatePriority",value:function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)}},{key:"getImmediateChild",value:function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?ft:t}},{key:"getChild",value:function(e){var t=Re(e);return null===t?this:this.getImmediateChild(t).getChild(Pe(e))}},{key:"hasChild",value:function(e){return null!==this.children_.get(e)}},{key:"updateImmediateChild",value:function(t,n){if((0,v.hu)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r,i,a=new Ge(t,n);n.isEmpty()?(r=this.children_.remove(t),i=this.indexMap_.removeFromIndexes(a,this.children_)):(r=this.children_.insert(t,n),i=this.indexMap_.addToIndexes(a,this.children_));var o=r.isEmpty()?ft:this.priorityNode_;return new e(r,o,i)}},{key:"updateChild",value:function(e,t){var n=Re(e);if(null===n)return t;(0,v.hu)(".priority"!==Re(e)||1===Ze(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(Pe(e),t);return this.updateImmediateChild(n,r)}},{key:"isEmpty",value:function(){return this.children_.isEmpty()}},{key:"numChildren",value:function(){return this.children_.count()}},{key:"val",value:function(t){if(this.isEmpty())return null;var n={},r=0,i=0,a=!0;if(this.forEachChild(vt,(function(o,s){n[o]=s.val(t),r++,a&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):a=!1})),!t&&a&&i<2*r){var o=[];for(var s in n)o[s]=n[s];return o}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}},{key:"hash",value:function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+ct(this.getPriority().val())+":"),this.forEachChild(vt,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":E(e)}return this.lazyHash_}},{key:"getPredecessorChildName",value:function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Ge(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)}},{key:"getFirstChildName",value:function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()}},{key:"getFirstChild",value:function(e){var t=this.getFirstChildName(e);return t?new Ge(t,this.children_.get(t)):null}},{key:"getLastChildName",value:function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()}},{key:"getLastChild",value:function(e){var t=this.getLastChildName(e);return t?new Ge(t,this.children_.get(t)):null}},{key:"forEachChild",value:function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)}},{key:"getIterator",value:function(e){return this.getIteratorFrom(e.minPost(),e)}},{key:"getIteratorFrom",value:function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,Ge.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r}},{key:"getReverseIterator",value:function(e){return this.getReverseIteratorFrom(e.maxPost(),e)}},{key:"getReverseIteratorFrom",value:function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,Ge.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r}},{key:"compareTo",value:function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===wt?-1:0}},{key:"withIndex",value:function(t){if(t===Xe||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)}},{key:"isIndexed",value:function(e){return e===Xe||this.indexMap_.hasIndex(e)}},{key:"equals",value:function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(vt),r=t.getIterator(vt),i=n.getNext(),a=r.getNext();i&&a;){if(i.name!==a.name||!i.node.equals(a.node))return!1;i=n.getNext(),a=r.getNext()}return null===i&&null===a}return!1}return!1}},{key:"resolveIndex_",value:function(e){return e===Xe?null:this.indexMap_.get(e.toString())}}],[{key:"EMPTY_NODE",get:function(){return ft||(ft=new e(new rt(at),null,kt.Default))}}]),e}();bt.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;var wt=new(function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,h.Z)(this,n),t.call(this,new rt(at),bt.EMPTY_NODE,kt.Default)}return(0,d.Z)(n,[{key:"compareTo",value:function(e){return e===this?0:1}},{key:"equals",value:function(e){return e===this}},{key:"getPriority",value:function(){return this}},{key:"getImmediateChild",value:function(e){return bt.EMPTY_NODE}},{key:"isEmpty",value:function(){return!1}}]),n}(bt));Object.defineProperties(Ge,{MIN:{value:new Ge(F,bt.EMPTY_NODE)},MAX:{value:new Ge(q,wt)}}),Qe.__EMPTY_NODE=bt.EMPTY_NODE,ht.__childrenNodeConstructor=bt,tt=wt,function(e){ut=e}(wt);var Ct=!0;function It(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return bt.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),(0,v.hu)(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e)return new ht(e,It(t));if(e instanceof Array||!Ct){var n=bt.EMPTY_NODE;return z(e,(function(t,r){if((0,v.r3)(e,t)&&"."!==t.substring(0,1)){var i=It(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(It(t))}var r=[],i=!1;if(z(e,(function(e,t){if("."!==e.substring(0,1)){var n=It(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Ge(e,n)))}})),0===r.length)return bt.EMPTY_NODE;var a=gt(r,it,(function(e){return e.name}),at);if(i){var o=gt(r,vt.getCompare());return new bt(a,It(t),new kt({".priority":o},{".priority":vt}))}return new bt(a,It(t),kt.Default)}!function(e){st=e}(It);var Tt=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).indexPath_=e,(0,v.hu)(!Le(e)&&".priority"!==Re(e),"Can't create PathIndex with empty path or .priority key"),r}return(0,d.Z)(n,[{key:"extractChild",value:function(e){return e.getChild(this.indexPath_)}},{key:"isDefinedOn",value:function(e){return!e.getChild(this.indexPath_).isEmpty()}},{key:"compare",value:function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?W(e.name,t.name):i}},{key:"makePost",value:function(e,t){var n=It(e),r=bt.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ge(t,r)}},{key:"maxPost",value:function(){var e=bt.EMPTY_NODE.updateChild(this.indexPath_,wt);return new Ge(q,e)}},{key:"toString",value:function(){return Ae(this.indexPath_,0).join("/")}}]),n}($e),St=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"compare",value:function(e,t){var n=e.node.compareTo(t.node);return 0===n?W(e.name,t.name):n}},{key:"isDefinedOn",value:function(e){return!0}},{key:"indexedValueChanged",value:function(e,t){return!e.equals(t)}},{key:"minPost",value:function(){return Ge.MIN}},{key:"maxPost",value:function(){return Ge.MAX}},{key:"makePost",value:function(e,t){var n=It(e);return new Ge(t,n)}},{key:"toString",value:function(){return".value"}}]),n}($e),Et=new St;function xt(e){return{type:"value",snapshotNode:e}}function Nt(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Rt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Zt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var Pt=function(){function e(){(0,h.Z)(this,e),this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=vt}return(0,d.Z)(e,[{key:"hasStart",value:function(){return this.startSet_}},{key:"isViewFromLeft",value:function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}},{key:"getIndexStartValue",value:function(){return(0,v.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}},{key:"getIndexStartName",value:function(){return(0,v.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:F}},{key:"hasEnd",value:function(){return this.endSet_}},{key:"getIndexEndValue",value:function(){return(0,v.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}},{key:"getIndexEndName",value:function(){return(0,v.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:q}},{key:"hasLimit",value:function(){return this.limitSet_}},{key:"hasAnchoredLimit",value:function(){return this.limitSet_&&""!==this.viewFrom_}},{key:"getLimit",value:function(){return(0,v.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}},{key:"getIndex",value:function(){return this.index_}},{key:"loadsAllData",value:function(){return!(this.startSet_||this.endSet_||this.limitSet_)}},{key:"isDefault",value:function(){return this.loadsAllData()&&this.index_===vt}},{key:"copy",value:function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}}]),e}();function Dt(e){var t,n={};if(e.isDefault())return n;if(e.index_===vt?t="$priority":e.index_===Et?t="$value":e.index_===Xe?t="$key":((0,v.hu)(e.index_ instanceof Tt,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,v.Wl)(t),e.startSet_){var r=e.startAfterSet_?"startAfter":"startAt";n[r]=(0,v.Wl)(e.indexStartValue_),e.startNameSet_&&(n[r]+=","+(0,v.Wl)(e.indexStartName_))}if(e.endSet_){var i=e.endBeforeSet_?"endBefore":"endAt";n[i]=(0,v.Wl)(e.indexEndValue_),e.endNameSet_&&(n[i]+=","+(0,v.Wl)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function At(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==vt&&(t.i=e.index_.toString()),t}var Ot=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a){var o;return(0,h.Z)(this,n),(o=t.call(this)).repoInfo_=e,o.onDataUpdate_=r,o.authTokenProvider_=i,o.appCheckTokenProvider_=a,o.log_=D("p:rest:"),o.listens_={},o}return(0,d.Z)(n,[{key:"reportStats",value:function(e){throw new Error("Method not implemented.")}},{key:"listen",value:function(e,t,r,i){var a=this,o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);var s=n.getListenId_(e,r),u={};this.listens_[s]=u;var c=Dt(e._queryParams);this.restRequest_(o+".json",c,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&a.onDataUpdate_(o,n,!1,r),(0,v.DV)(a.listens_,s)===u)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))}},{key:"unlisten",value:function(e,t){var r=n.getListenId_(e,t);delete this.listens_[r]}},{key:"get",value:function(e){var t=this,n=Dt(e._queryParams),r=e._path.toString(),i=new v.BH;return this.restRequest_(r+".json",n,(function(e,n){var a=n;404===e&&(a=null,e=null),null===e?(t.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))})),i.promise}},{key:"refreshAuthToken",value:function(e){}},{key:"restRequest_",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(a){var o=(0,i.Z)(a,2),s=o[0],u=o[1];s&&s.accessToken&&(n.auth=s.accessToken),u&&u.token&&(n.ac=u.token);var c=(t.repoInfo_.secure?"https://":"http://")+t.repoInfo_.host+e+"?ns="+t.repoInfo_.namespace+(0,v.xO)(n);t.log_("Sending REST request for "+c);var l=new XMLHttpRequest;l.onreadystatechange=function(){if(r&&4===l.readyState){t.log_("REST Response for "+c+" received. status:",l.status,"response:",l.responseText);var e=null;if(l.status>=200&&l.status<300){try{e=(0,v.cI)(l.responseText)}catch(n){M("Failed to parse JSON response for "+c+": "+l.responseText)}r(null,e)}else 401!==l.status&&404!==l.status&&M("Got unsuccessful REST response for "+c+" Status: "+l.status),r(l.status);r=null}},l.open("GET",c,!0),l.send()}))}}],[{key:"getListenId_",value:function(e,t){return void 0!==t?"tag$"+t:((0,v.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}}]),n}(Ce),Mt=function(){function e(){(0,h.Z)(this,e),this.rootNode_=bt.EMPTY_NODE}return(0,d.Z)(e,[{key:"getNode",value:function(e){return this.rootNode_.getChild(e)}},{key:"updateSnapshot",value:function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}]),e}();function Lt(){return{value:null,children:new Map}}function Ft(e,t,n){if(Le(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=Re(t);e.children.has(r)||e.children.set(r,Lt()),Ft(e.children.get(r),t=Pe(t),n)}}function qt(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((function(e,n){t(n,e)}))}(e,(function(e,r){qt(r,new xe(t.toString()+"/"+e),n)}))}var Wt,jt=function(){function e(t){(0,h.Z)(this,e),this.collection_=t,this.last_=null}return(0,d.Z)(e,[{key:"get",value:function(){var e=this.collection_.get(),t=Object.assign({},e);return this.last_&&z(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t}}]),e}(),Ut=1e4,Bt=3e4,Ht=function(){function e(t,n){(0,h.Z)(this,e),this.server_=n,this.statsToReport_={},this.statsListener_=new jt(t);var r=Ut+(Bt-Ut)*Math.random();Q(this.reportStats_.bind(this),Math.floor(r))}return(0,d.Z)(e,[{key:"reportStats_",value:function(){var e=this,t=this.statsListener_.get(),n={},r=!1;z(t,(function(t,i){i>0&&(0,v.r3)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),Q(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}]),e}();function zt(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Wt||(Wt={}));var Vt,Kt=function(){function e(t,n,r){(0,h.Z)(this,e),this.path=t,this.affectedTree=n,this.revert=r,this.type=Wt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return(0,d.Z)(e,[{key:"operationForChild",value:function(t){if(Le(this.path)){if(null!=this.affectedTree.value)return(0,v.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new xe(t));return new e(Ne(),n,this.revert)}return(0,v.hu)(Re(this.path)===t,"operationForChild called for unrelated child."),new e(Pe(this.path),this.affectedTree,this.revert)}}]),e}(),Yt=function(){function e(t,n,r){(0,h.Z)(this,e),this.source=t,this.path=n,this.snap=r,this.type=Wt.OVERWRITE}return(0,d.Z)(e,[{key:"operationForChild",value:function(t){return Le(this.path)?new e(this.source,Ne(),this.snap.getImmediateChild(t)):new e(this.source,Pe(this.path),this.snap)}}]),e}(),Gt=function(){function e(t,n,r){(0,h.Z)(this,e),this.source=t,this.path=n,this.children=r,this.type=Wt.MERGE}return(0,d.Z)(e,[{key:"operationForChild",value:function(t){if(Le(this.path)){var n=this.children.subtree(new xe(t));return n.isEmpty()?null:n.value?new Yt(this.source,Ne(),n.value):new e(this.source,Ne(),n)}return(0,v.hu)(Re(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,Pe(this.path),this.children)}},{key:"toString",value:function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}]),e}(),$t=function(){function e(t,n,r){(0,h.Z)(this,e),this.node_=t,this.fullyInitialized_=n,this.filtered_=r}return(0,d.Z)(e,[{key:"isFullyInitialized",value:function(){return this.fullyInitialized_}},{key:"isFiltered",value:function(){return this.filtered_}},{key:"isCompleteForPath",value:function(e){if(Le(e))return this.isFullyInitialized()&&!this.filtered_;var t=Re(e);return this.isCompleteForChild(t)}},{key:"isCompleteForChild",value:function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}},{key:"getNode",value:function(){return this.node_}}]),e}();function Qt(e,t,n,r,i,a){var o=r.filter((function(e){return e.type===n}));o.sort((function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw(0,v.g5)("Should only compare child_ events.");var r=new Ge(t.childName,t.snapshotNode),i=new Ge(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)})),o.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,a);i.forEach((function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function Xt(e,t){return{eventCache:e,serverCache:t}}function Jt(e,t,n,r){return Xt(new $t(t,n,r),e.serverCache)}function en(e,t,n,r){return Xt(e.eventCache,new $t(t,n,r))}function tn(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function nn(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var rn=function(){return Vt||(Vt=new rt(j)),Vt},an=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:rn();(0,h.Z)(this,e),this.value=t,this.children=n}return(0,d.Z)(e,[{key:"isEmpty",value:function(){return null===this.value&&this.children.isEmpty()}},{key:"findRootMostMatchingPathAndValue",value:function(e,t){if(null!=this.value&&t(this.value))return{path:Ne(),value:this.value};if(Le(e))return null;var n=Re(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(Pe(e),t);return null!=i?{path:Me(new xe(n),i.path),value:i.value}:null}return null}},{key:"findRootMostValueAndPath",value:function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))}},{key:"subtree",value:function(t){if(Le(t))return this;var n=Re(t),r=this.children.get(n);return null!==r?r.subtree(Pe(t)):new e(null)}},{key:"set",value:function(t,n){if(Le(t))return new e(n,this.children);var r=Re(t),i=(this.children.get(r)||new e(null)).set(Pe(t),n),a=this.children.insert(r,i);return new e(this.value,a)}},{key:"remove",value:function(t){if(Le(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=Re(t),r=this.children.get(n);if(r){var i,a=r.remove(Pe(t));return i=a.isEmpty()?this.children.remove(n):this.children.insert(n,a),null===this.value&&i.isEmpty()?new e(null):new e(this.value,i)}return this}},{key:"get",value:function(e){if(Le(e))return this.value;var t=Re(e),n=this.children.get(t);return n?n.get(Pe(e)):null}},{key:"setTree",value:function(t,n){if(Le(t))return n;var r,i=Re(t),a=(this.children.get(i)||new e(null)).setTree(Pe(t),n);return r=a.isEmpty()?this.children.remove(i):this.children.insert(i,a),new e(this.value,r)}},{key:"fold",value:function(e){return this.fold_(Ne(),e)}},{key:"fold_",value:function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(Me(e,r),t)})),t(e,this.value,n)}},{key:"findOnPath",value:function(e,t){return this.findOnPath_(e,Ne(),t)}},{key:"findOnPath_",value:function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(Le(e))return null;var i=Re(e),a=this.children.get(i);return a?a.findOnPath_(Pe(e),Me(t,i),n):null}},{key:"foreachOnPath",value:function(e,t){return this.foreachOnPath_(e,Ne(),t)}},{key:"foreachOnPath_",value:function(t,n,r){if(Le(t))return this;this.value&&r(n,this.value);var i=Re(t),a=this.children.get(i);return a?a.foreachOnPath_(Pe(t),Me(n,i),r):new e(null)}},{key:"foreach",value:function(e){this.foreach_(Ne(),e)}},{key:"foreach_",value:function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(Me(e,n),t)})),this.value&&t(e,this.value)}},{key:"foreachChild",value:function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))}}],[{key:"fromObject",value:function(t){var n=new e(null);return z(t,(function(e,t){n=n.set(new xe(e),t)})),n}}]),e}(),on=function(){function e(t){(0,h.Z)(this,e),this.writeTree_=t}return(0,d.Z)(e,null,[{key:"empty",value:function(){return new e(new an(null))}}]),e}();function sn(e,t,n){if(Le(t))return new on(new an(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,a=r.value,o=Fe(i,t);return a=a.updateChild(o,n),new on(e.writeTree_.set(i,a))}var s=new an(n),u=e.writeTree_.setTree(t,s);return new on(u)}function un(e,t,n){var r=e;return z(n,(function(e,n){r=sn(r,Me(t,e),n)})),r}function cn(e,t){if(Le(t))return on.empty();var n=e.writeTree_.setTree(t,new an(null));return new on(n)}function ln(e,t){return null!=hn(e,t)}function hn(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Fe(n.path,t)):null}function dn(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(vt,(function(e,n){t.push(new Ge(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Ge(e,n.value))})),t}function fn(e,t){if(Le(t))return e;var n=hn(e,t);return new on(null!=n?new an(n):e.writeTree_.subtree(t))}function pn(e){return e.writeTree_.isEmpty()}function vn(e,t){return _n(Ne(),e.writeTree_,t)}function _n(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?((0,v.hu)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=_n(Me(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Me(e,".priority"),r)),n}function yn(e,t){return Rn(t,e)}function gn(e,t){var n=e.allWrites.findIndex((function(e){return e.writeId===t}));(0,v.hu)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,a=!1,o=e.allWrites.length-1;i&&o>=0;){var s=e.allWrites[o];s.visible&&(o>=n&&mn(s,r.path)?i=!1:We(r.path,s.path)&&(a=!0)),o--}if(i){if(a)return function(e){e.visibleWrites=bn(e.allWrites,kn,Ne()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;r.snap?e.visibleWrites=cn(e.visibleWrites,r.path):z(r.children,(function(t){e.visibleWrites=cn(e.visibleWrites,Me(r.path,t))}));return!0}return!1}function mn(e,t){if(e.snap)return We(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&We(Me(e.path,n),t))return!0;return!1}function kn(e){return e.visible}function bn(e,t,n){for(var r=on.empty(),i=0;i<e.length;++i){var a=e[i];if(t(a)){var o=a.path,s=void 0;if(a.snap)We(n,o)?r=sn(r,s=Fe(n,o),a.snap):We(o,n)&&(s=Fe(o,n),r=sn(r,Ne(),a.snap.getChild(s)));else{if(!a.children)throw(0,v.g5)("WriteRecord should have .snap or .children");if(We(n,o))r=un(r,s=Fe(n,o),a.children);else if(We(o,n))if(Le(s=Fe(o,n)))r=un(r,Ne(),a.children);else{var u=(0,v.DV)(a.children,Re(s));if(u){var c=u.getChild(Pe(s));r=sn(r,Ne(),c)}}}}}return r}function wn(e,t,n,r,i){if(r||i){var a=fn(e.visibleWrites,t);if(!i&&pn(a))return n;if(i||null!=n||ln(a,Ne())){return vn(bn(e.allWrites,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(We(e.path,t)||We(t,e.path))}),t),n||bt.EMPTY_NODE)}return null}var o=hn(e.visibleWrites,t);if(null!=o)return o;var s=fn(e.visibleWrites,t);return pn(s)?n:null!=n||ln(s,Ne())?vn(s,n||bt.EMPTY_NODE):null}function Cn(e,t,n,r){return wn(e.writeTree,e.treePath,t,n,r)}function In(e,t){return function(e,t,n){var r=bt.EMPTY_NODE,i=hn(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(vt,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var a=fn(e.visibleWrites,t);return n.forEachChild(vt,(function(e,t){var n=vn(fn(a,new xe(e)),t);r=r.updateImmediateChild(e,n)})),dn(a).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return dn(fn(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Tn(e,t,n,r){return function(e,t,n,r,i){(0,v.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");var a=Me(t,n);if(ln(e.visibleWrites,a))return null;var o=fn(e.visibleWrites,a);return pn(o)?i.getChild(n):vn(o,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function Sn(e,t){return function(e,t){return hn(e.visibleWrites,t)}(e.writeTree,Me(e.treePath,t))}function En(e,t,n,r,i,a){return function(e,t,n,r,i,a,o){var s,u=fn(e.visibleWrites,t),c=hn(u,Ne());if(null!=c)s=c;else{if(null==n)return[];s=vn(u,n)}if((s=s.withIndex(o)).isEmpty()||s.isLeafNode())return[];for(var l=[],h=o.getCompare(),d=a?s.getReverseIteratorFrom(r,o):s.getIteratorFrom(r,o),f=d.getNext();f&&l.length<i;)0!==h(f,r)&&l.push(f),f=d.getNext();return l}(e.writeTree,e.treePath,t,n,r,i,a)}function xn(e,t,n){return function(e,t,n,r){var i=Me(t,n),a=hn(e.visibleWrites,i);return null!=a?a:r.isCompleteForChild(n)?vn(fn(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Nn(e,t){return Rn(Me(e.treePath,t),e.writeTree)}function Rn(e,t){return{treePath:e,writeTree:t}}var Zn=function(){function e(){(0,h.Z)(this,e),this.changeMap=new Map}return(0,d.Z)(e,[{key:"trackChildChange",value:function(e){var t=e.type,n=e.childName;(0,v.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,v.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Zt(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Rt(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Nt(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw(0,v.g5)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Zt(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}},{key:"getChanges",value:function(){return Array.from(this.changeMap.values())}}]),e}(),Pn=new(function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"getCompleteChild",value:function(e){return null}},{key:"getChildAfterChild",value:function(e,t,n){return null}}]),e}()),Dn=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,h.Z)(this,e),this.writes_=t,this.viewCache_=n,this.optCompleteServerCache_=r}return(0,d.Z)(e,[{key:"getCompleteChild",value:function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new $t(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return xn(this.writes_,e,n)}},{key:"getChildAfterChild",value:function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nn(this.viewCache_),i=En(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}]),e}();function An(e,t,n,r,i){var a,o,s=new Zn;if(n.type===Wt.OVERWRITE){var u=n;u.source.fromUser?a=Ln(e,t,u.path,u.snap,r,i,s):((0,v.hu)(u.source.fromServer,"Unknown source."),o=u.source.tagged||t.serverCache.isFiltered()&&!Le(u.path),a=Mn(e,t,u.path,u.snap,r,i,o,s))}else if(n.type===Wt.MERGE){var c=n;c.source.fromUser?a=function(e,t,n,r,i,a,o){var s=t;return r.foreach((function(r,u){var c=Me(n,r);Fn(t,Re(c))&&(s=Ln(e,s,c,u,i,a,o))})),r.foreach((function(r,u){var c=Me(n,r);Fn(t,Re(c))||(s=Ln(e,s,c,u,i,a,o))})),s}(e,t,c.path,c.children,r,i,s):((0,v.hu)(c.source.fromServer,"Unknown source."),o=c.source.tagged||t.serverCache.isFiltered(),a=Wn(e,t,c.path,c.children,r,i,o,s))}else if(n.type===Wt.ACK_USER_WRITE){var l=n;a=l.revert?function(e,t,n,r,i,a){var o;if(null!=Sn(r,n))return t;var s,u=new Dn(r,t,i),c=t.eventCache.getNode();if(Le(n)||".priority"===Re(n)){var l;if(t.serverCache.isFullyInitialized())l=Cn(r,nn(t));else{var h=t.serverCache.getNode();(0,v.hu)(h instanceof bt,"serverChildren would be complete if leaf node"),l=In(r,h)}s=e.filter.updateFullNode(c,l,a)}else{var d=Re(n),f=xn(r,d,t.serverCache);null==f&&t.serverCache.isCompleteForChild(d)&&(f=c.getImmediateChild(d)),(s=null!=f?e.filter.updateChild(c,d,f,Pe(n),u,a):t.eventCache.getNode().hasChild(d)?e.filter.updateChild(c,d,bt.EMPTY_NODE,Pe(n),u,a):c).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Cn(r,nn(t))).isLeafNode()&&(s=e.filter.updateFullNode(s,o,a))}return o=t.serverCache.isFullyInitialized()||null!=Sn(r,Ne()),Jt(t,s,o,e.filter.filtersNodes())}(e,t,l.path,r,i,s):function(e,t,n,r,i,a,o){if(null!=Sn(i,n))return t;var s=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(Le(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return Mn(e,t,n,u.getNode().getChild(n),i,a,s,o);if(Le(n)){var c=new an(null);return u.getNode().forEachChild(Xe,(function(e,t){c=c.set(new xe(e),t)})),Wn(e,t,n,c,i,a,s,o)}return t}var l=new an(null);return r.foreach((function(e,t){var r=Me(n,e);u.isCompleteForPath(r)&&(l=l.set(e,u.getNode().getChild(r)))})),Wn(e,t,n,l,i,a,s,o)}(e,t,l.path,l.affectedTree,r,i,s)}else{if(n.type!==Wt.LISTEN_COMPLETE)throw(0,v.g5)("Unknown operation type: "+n.type);a=function(e,t,n,r,i){var a=t.serverCache,o=en(t,a.getNode(),a.isFullyInitialized()||Le(n),a.isFiltered());return On(e,o,n,r,Pn,i)}(e,t,n.path,r,s)}var h=s.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=tn(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&n.push(xt(tn(t)))}}(t,a,h),{viewCache:a,changes:h}}function On(e,t,n,r,i,a){var o,s,u=t.eventCache;if(null!=Sn(r,n))return t;if(Le(n))if((0,v.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var c=nn(t),l=In(r,c instanceof bt?c:bt.EMPTY_NODE);o=e.filter.updateFullNode(t.eventCache.getNode(),l,a)}else{var h=Cn(r,nn(t));o=e.filter.updateFullNode(t.eventCache.getNode(),h,a)}else{var d=Re(n);if(".priority"===d){(0,v.hu)(1===Ze(n),"Can't have a priority with additional path components");var f=u.getNode(),p=Tn(r,n,f,s=t.serverCache.getNode());o=null!=p?e.filter.updatePriority(f,p):u.getNode()}else{var _,y=Pe(n);if(u.isCompleteForChild(d)){s=t.serverCache.getNode();var g=Tn(r,n,u.getNode(),s);_=null!=g?u.getNode().getImmediateChild(d).updateChild(y,g):u.getNode().getImmediateChild(d)}else _=xn(r,d,t.serverCache);o=null!=_?e.filter.updateChild(u.getNode(),d,_,y,i,a):u.getNode()}}return Jt(t,o,u.isFullyInitialized()||Le(n),e.filter.filtersNodes())}function Mn(e,t,n,r,i,a,o,s){var u,c=t.serverCache,l=o?e.filter:e.filter.getIndexedFilter();if(Le(n))u=l.updateFullNode(c.getNode(),r,null);else if(l.filtersNodes()&&!c.isFiltered()){var h=c.getNode().updateChild(n,r);u=l.updateFullNode(c.getNode(),h,null)}else{var d=Re(n);if(!c.isCompleteForPath(n)&&Ze(n)>1)return t;var f=Pe(n),p=c.getNode().getImmediateChild(d).updateChild(f,r);u=".priority"===d?l.updatePriority(c.getNode(),p):l.updateChild(c.getNode(),d,p,f,Pn,null)}var v=en(t,u,c.isFullyInitialized()||Le(n),l.filtersNodes());return On(e,v,n,i,new Dn(i,v,a),s)}function Ln(e,t,n,r,i,a,o){var s,u,c=t.eventCache,l=new Dn(i,t,a);if(Le(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,o),s=Jt(t,u,!0,e.filter.filtersNodes());else{var h=Re(n);if(".priority"===h)u=e.filter.updatePriority(t.eventCache.getNode(),r),s=Jt(t,u,c.isFullyInitialized(),c.isFiltered());else{var d,f=Pe(n),p=c.getNode().getImmediateChild(h);if(Le(f))d=r;else{var v=l.getCompleteChild(h);d=null!=v?".priority"===De(f)&&v.getChild(Oe(f)).isEmpty()?v:v.updateChild(f,r):bt.EMPTY_NODE}if(p.equals(d))s=t;else s=Jt(t,e.filter.updateChild(c.getNode(),h,d,f,l,o),c.isFullyInitialized(),e.filter.filtersNodes())}}return s}function Fn(e,t){return e.eventCache.isCompleteForChild(t)}function qn(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function Wn(e,t,n,r,i,a,o,s){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,c=t;u=Le(n)?r:new an(null).setTree(n,r);var l=t.serverCache.getNode();return u.children.inorderTraversal((function(n,r){if(l.hasChild(n)){var u=qn(0,t.serverCache.getNode().getImmediateChild(n),r);c=Mn(e,c,new xe(n),u,i,a,o,s)}})),u.children.inorderTraversal((function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!l.hasChild(n)&&!u){var h=qn(0,t.serverCache.getNode().getImmediateChild(n),r);c=Mn(e,c,new xe(n),h,i,a,o,s)}})),c}var jn;function Un(e,t){var n=nn(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Le(t)&&!n.getImmediateChild(Re(t)).isEmpty())?n.getChild(t):null}function Bn(e,t,n,r){t.type===Wt.MERGE&&null!==t.source.queryId&&((0,v.hu)(nn(e.viewCache_),"We should always have a full cache before handling merges"),(0,v.hu)(tn(e.viewCache_),"Missing event cache, even though we have a server cache"));var i,a,o=e.viewCache_,s=An(e.processor_,o,t,n,r);return i=e.processor_,a=s.viewCache,(0,v.hu)(a.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,v.hu)(a.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,v.hu)(s.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Hn(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Hn(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){var i=[],a=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&a.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Qt(e,i,"child_removed",t,r,n),Qt(e,i,"child_added",t,r,n),Qt(e,i,"child_moved",a,r,n),Qt(e,i,"child_changed",t,r,n),Qt(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}var zn;function Vn(e,t,n,r){var i=t.source.queryId;if(null!==i){var a=e.views.get(i);return(0,v.hu)(null!=a,"SyncTree gave us an op for an invalid query."),Bn(a,t,n,r)}var o,s=[],u=(0,l.Z)(e.views.values());try{for(u.s();!(o=u.n()).done;){var c=o.value;s=s.concat(Bn(c,t,n,r))}}catch(h){u.e(h)}finally{u.f()}return s}function Kn(e,t){var n,r=null,i=(0,l.Z)(e.views.values());try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r||Un(a,t)}}catch(o){i.e(o)}finally{i.f()}return r}var Yn=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.listenProvider_=t,this.syncPointTree_=new an(null),this.pendingWriteTree_={visibleWrites:on.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}));function Gn(e,t,n,r,i){return function(e,t,n,r,i){(0,v.hu)(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=sn(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?er(e,new Yt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function $n(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(gn(e.pendingWriteTree_,t)){var i=new an(null);return null!=r.snap?i=i.set(Ne(),!0):z(r.children,(function(e){i=i.set(new xe(e),!0)})),er(e,new Kt(r.path,i,n))}return[]}function Qn(e,t,n){return er(e,new Yt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Xn(e,t,n,r){var i=rr(e,r);if(null!=i){var a=ir(i),o=a.path,s=a.queryId,u=Fe(o,t);return ar(e,o,new Yt(zt(s),u,n))}return[]}function Jn(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(function(e,n){var r=Kn(n,Fe(e,t));if(r)return r}));return wn(r,t,i,n,!0)}function er(e,t){return tr(t,e.syncPointTree_,null,yn(e.pendingWriteTree_,Ne()))}function tr(e,t,n,r){if(Le(e.path))return nr(e,t,n,r);var i=t.get(Ne());null==n&&null!=i&&(n=Kn(i,Ne()));var a=[],o=Re(e.path),s=e.operationForChild(o),u=t.children.get(o);if(u&&s){var c=n?n.getImmediateChild(o):null,l=Nn(r,o);a=a.concat(tr(s,u,c,l))}return i&&(a=a.concat(Vn(i,e,r,n))),a}function nr(e,t,n,r){var i=t.get(Ne());null==n&&null!=i&&(n=Kn(i,Ne()));var a=[];return t.children.inorderTraversal((function(t,i){var o=n?n.getImmediateChild(t):null,s=Nn(r,t),u=e.operationForChild(t);u&&(a=a.concat(nr(u,i,o,s)))})),i&&(a=a.concat(Vn(i,e,r,n))),a}function rr(e,t){return e.tagToQueryMap.get(t)}function ir(e){var t=e.indexOf("$");return(0,v.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new xe(e.substr(0,t))}}function ar(e,t,n){var r=e.syncPointTree_.get(t);return(0,v.hu)(r,"Missing sync point for query tag that we're tracking"),Vn(r,n,yn(e.pendingWriteTree_,t),null)}var or=function(){function e(t){(0,h.Z)(this,e),this.node_=t}return(0,d.Z)(e,[{key:"getImmediateChild",value:function(t){return new e(this.node_.getImmediateChild(t))}},{key:"node",value:function(){return this.node_}}]),e}(),sr=function(){function e(t,n){(0,h.Z)(this,e),this.syncTree_=t,this.path_=n}return(0,d.Z)(e,[{key:"getImmediateChild",value:function(t){var n=Me(this.path_,t);return new e(this.syncTree_,n)}},{key:"node",value:function(){return Jn(this.syncTree_,this.path_)}}]),e}(),ur=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},cr=function(e,t,n){return e&&"object"===typeof e?((0,v.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?lr(e[".sv"],t,n):"object"===typeof e[".sv"]?hr(e[".sv"],t):void(0,v.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},lr=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,v.hu)(!1,"Unexpected server value: "+e)},hr=function(e,t,n){e.hasOwnProperty("increment")||(0,v.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!==typeof r&&(0,v.hu)(!1,"Unexpected increment value: "+r);var i=t.node();if((0,v.hu)(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var a=i.getValue();return"number"!==typeof a?r:a+r},dr=function(e,t,n,r){return pr(t,new sr(n,e),r)},fr=function(e,t,n){return pr(e,new or(t),n)};function pr(e,t,n){var r,i=e.getPriority().val(),a=cr(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var o=e,s=cr(o.getValue(),t,n);return s!==o.getValue()||a!==o.getPriority().val()?new ht(s,It(a)):e}var u=e;return r=u,a!==u.getPriority().val()&&(r=r.updatePriority(new ht(a))),u.forEachChild(vt,(function(e,i){var a=pr(i,t.getImmediateChild(e),n);a!==i&&(r=r.updateImmediateChild(e,a))})),r}var vr=(0,d.Z)((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{children:{},childCount:0};(0,h.Z)(this,e),this.name=t,this.parent=n,this.node=r}));function _r(e,t){for(var n=t instanceof xe?t:new xe(t),r=e,i=Re(n);null!==i;){var a=(0,v.DV)(r.node.children,i)||{children:{},childCount:0};r=new vr(i,r,a),i=Re(n=Pe(n))}return r}function yr(e){return e.node.value}function gr(e,t){e.node.value=t,Cr(e)}function mr(e){return e.node.childCount>0}function kr(e,t){z(e.node.children,(function(n,r){t(new vr(n,e,r))}))}function br(e,t,n,r){n&&!r&&t(e),kr(e,(function(e){br(e,t,!0,r)})),n&&r&&t(e)}function wr(e){return new xe(null===e.parent?e.name:wr(e.parent)+"/"+e.name)}function Cr(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===yr(e)&&!mr(e)}(n),i=(0,v.r3)(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Cr(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Cr(e))}(e.parent,e.name,e)}var Ir=/[\[\].#$\/\u0000-\u001F\u007F]/,Tr=/[\[\].#$\u0000-\u001F\u007F]/,Sr=10485760,Er=function(e){return"string"===typeof e&&0!==e.length&&!Ir.test(e)},xr=function(e){return"string"===typeof e&&0!==e.length&&!Tr.test(e)},Nr=function e(t,n,r){var i=r instanceof xe?new je(r,t):r;if(void 0===n)throw new Error(t+"contains undefined "+Be(i));if("function"===typeof n)throw new Error(t+"contains a function "+Be(i)+" with contents = "+n.toString());if(L(n))throw new Error(t+"contains "+n.toString()+" "+Be(i));if("string"===typeof n&&n.length>Sr/3&&(0,v.ug)(n)>Sr)throw new Error(t+"contains a string greater than "+Sr+" utf8 bytes "+Be(i)+" ('"+n.substring(0,50)+"...')");if(n&&"object"===typeof n){var a=!1,o=!1;if(z(n,(function(n,r){if(".value"===n)a=!0;else if(".priority"!==n&&".sv"!==n&&(o=!0,!Er(n)))throw new Error(t+" contains an invalid key ("+n+") "+Be(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var s,u;u=n,(s=i).parts_.length>0&&(s.byteLength_+=1),s.parts_.push(u),s.byteLength_+=(0,v.ug)(u),Ue(s),e(t,r,i),function(e){var t=e.parts_.pop();e.byteLength_-=(0,v.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),a&&o)throw new Error(t+' contains ".value" child '+Be(i)+" in addition to actual children.")}},Rr=function(e,t){var n=t.path.toString();if("string"!==typeof t.repoInfo.host||0===t.repoInfo.host.length||!Er(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),xr(e)}(n))throw new Error((0,v.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},Zr=(0,d.Z)((function e(){(0,h.Z)(this,e),this.eventLists_=[],this.recursionDepth_=0}));function Pr(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],a=i.getPath();null===n||qe(a,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:a}),n.events.push(i)}n&&e.eventLists_.push(n)}function Dr(e,t,n){Pr(e,n),Ar(e,(function(e){return We(e,t)||We(t,e)}))}function Ar(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];if(i)t(i.path)?(Or(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function Or(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();N&&P("event: "+n.toString()),G(r)}}}var Mr="repo_interrupt",Lr=25,Fr=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.repoInfo_=t,this.forceRestClient_=n,this.authTokenProvider_=r,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Zr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Lt(),this.transactionQueueTree_=new vr,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return(0,d.Z)(e,[{key:"toString",value:function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}]),e}();function qr(e,t,n){if(e.stats_=he(e.repoInfo_),e.forceRestClient_||$())e.server_=new Ot(e.repoInfo_,(function(t,n,r,i){Ur(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return Br(e,!0)}),0);else{if("undefined"!==typeof n&&null!==n){if("object"!==typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,v.Wl)(n)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}e.persistentConnection_=new Ke(e.repoInfo_,t,(function(t,n,r,i){Ur(e,t,n,r,i)}),(function(t){Br(e,t)}),(function(t){!function(e,t){z(t,(function(t,n){Hr(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){var n=e.toString();return le[n]||(le[n]=t()),le[n]}(e.repoInfo_,(function(){return new Ht(e.stats_,e.server_)})),e.infoData_=new Mt,e.infoSyncTree_=new Yn({startListening:function(t,n,r,i){var a=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(a=Qn(e.infoSyncTree_,t._path,o),setTimeout((function(){i("ok")}),0)),a},stopListening:function(){}}),Hr(e,"connected",!1),e.serverSyncTree_=new Yn({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var a=i(n,r);Dr(e.eventQueue_,t._path,a)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function Wr(e){var t=e.infoData_.getNode(new xe(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function jr(e){return ur({timestamp:Wr(e)})}function Ur(e,t,n,r,i){e.dataUpdateCount++;var a=new xe(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var o=[];if(i)if(r){var s=(0,v.UI)(n,(function(e){return It(e)}));o=function(e,t,n,r){var i=rr(e,r);if(i){var a=ir(i),o=a.path,s=a.queryId,u=Fe(o,t),c=an.fromObject(n);return ar(e,o,new Gt(zt(s),u,c))}return[]}(e.serverSyncTree_,a,s,i)}else{var u=It(n);o=Xn(e.serverSyncTree_,a,u,i)}else if(r){var c=(0,v.UI)(n,(function(e){return It(e)}));o=function(e,t,n){var r=an.fromObject(n);return er(e,new Gt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,a,c)}else{var l=It(n);o=Qn(e.serverSyncTree_,a,l)}var h=a;o.length>0&&(h=$r(e,a)),Dr(e.eventQueue_,h,o)}function Br(e,t){Hr(e,"connected",t),!1===t&&function(e){Kr(e,"onDisconnectEvents");var t=jr(e),n=Lt();qt(e.onDisconnect_,Ne(),(function(r,i){var a=dr(r,i,e.serverSyncTree_,t);Ft(n,r,a)}));var r=[];qt(n,Ne(),(function(t,n){r=r.concat(Qn(e.serverSyncTree_,t,n));var i=ti(e,t);$r(e,i)})),e.onDisconnect_=Lt(),Dr(e.eventQueue_,Ne(),r)}(e)}function Hr(e,t,n){var r=new xe("/.info/"+t),i=It(n);e.infoData_.updateSnapshot(r,i);var a=Qn(e.infoSyncTree_,r,i);Dr(e.eventQueue_,r,a)}function zr(e){return e.nextWriteId_++}function Vr(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Mr)}function Kr(e){var t="";e.persistentConnection_&&(t=e.persistentConnection_.id+":");for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];P.apply(void 0,[t].concat(r))}function Yr(e,t,n){return Jn(e.serverSyncTree_,t,n)||bt.EMPTY_NODE}function Gr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.transactionQueueTree_;if(t||ei(e,t),yr(t)){var n=Xr(e,t);(0,v.hu)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return 0===e.status}))&&function(e,t,n){for(var r=n.map((function(e){return e.currentWriteId})),i=Yr(e,t,r),a=i,o=i.hash(),s=0;s<n.length;s++){var u=n[s];(0,v.hu)(0===u.status,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;var c=Fe(t,u.path);a=a.updateChild(c,u.currentOutputSnapshotRaw)}var l=a.val(!0),h=t;e.server_.put(h.toString(),l,(function(r){Kr(e,"transaction put response",{path:h.toString(),status:r});var i=[];if("ok"===r){for(var a=[],o=function(t){n[t].status=2,i=i.concat($n(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&a.push((function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)})),n[t].unwatcher()},s=0;s<n.length;s++)o(s);ei(e,_r(e.transactionQueueTree_,t)),Gr(e,e.transactionQueueTree_),Dr(e.eventQueue_,t,i);for(var u=0;u<a.length;u++)G(a[u])}else{if("datastale"===r)for(var c=0;c<n.length;c++)3===n[c].status?n[c].status=4:n[c].status=0;else{M("transaction at "+h.toString()+" failed: "+r);for(var l=0;l<n.length;l++)n[l].status=4,n[l].abortReason=r}$r(e,t)}}),o)}(e,wr(t),n)}else mr(t)&&kr(t,(function(t){Gr(e,t)}))}function $r(e,t){var n=Qr(e,t),r=wr(n);return function(e,t,n){if(0===t.length)return;for(var r=[],i=[],a=t.filter((function(e){return 0===e.status})).map((function(e){return e.currentWriteId})),o=function(o){var s,u,c=t[o],l=Fe(n,c.path),h=!1;if((0,v.hu)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)h=!0,s=c.abortReason,i=i.concat($n(e.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=Lr)h=!0,s="maxretry",i=i.concat($n(e.serverSyncTree_,c.currentWriteId,!0));else{var d=Yr(e,c.path,a);c.currentInputSnapshot=d;var f=t[o].update(d.val());if(void 0!==f){Nr("transaction failed: Data returned ",f,c.path);var p=It(f);"object"===typeof f&&null!=f&&(0,v.r3)(f,".priority")||(p=p.updatePriority(d.getPriority()));var _=c.currentWriteId,y=jr(e),g=fr(p,d,y);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=g,c.currentWriteId=zr(e),a.splice(a.indexOf(_),1),i=(i=i.concat(Gn(e.serverSyncTree_,c.path,g,c.currentWriteId,c.applyLocally))).concat($n(e.serverSyncTree_,_,!0))}else h=!0,s="nodata",i=i.concat($n(e.serverSyncTree_,c.currentWriteId,!0))}Dr(e.eventQueue_,n,i),i=[],h&&(t[o].status=2,u=t[o].unwatcher,setTimeout(u,Math.floor(0)),t[o].onComplete&&("nodata"===s?r.push((function(){return t[o].onComplete(null,!1,t[o].currentInputSnapshot)})):r.push((function(){return t[o].onComplete(new Error(s),!1,null)}))))},s=0;s<t.length;s++)o(s);ei(e,e.transactionQueueTree_);for(var u=0;u<r.length;u++)G(r[u]);Gr(e,e.transactionQueueTree_)}(e,Xr(e,n),r),r}function Qr(e,t){var n,r=e.transactionQueueTree_;for(n=Re(t);null!==n&&void 0===yr(r);)r=_r(r,n),n=Re(t=Pe(t));return r}function Xr(e,t){var n=[];return Jr(e,t,n),n.sort((function(e,t){return e.order-t.order})),n}function Jr(e,t,n){var r=yr(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);kr(t,(function(t){Jr(e,t,n)}))}function ei(e,t){var n=yr(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,gr(t,n.length>0?n:void 0)}kr(t,(function(t){ei(e,t)}))}function ti(e,t){var n=wr(Qr(e,t)),r=_r(e.transactionQueueTree_,t);return function(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,(function(t){ni(e,t)})),ni(e,r),br(r,(function(t){ni(e,t)})),n}function ni(e,t){var n=yr(t);if(n){for(var r=[],i=[],a=-1,o=0;o<n.length;o++)3===n[o].status||(1===n[o].status?((0,v.hu)(a===o-1,"All SENT items should be at beginning of queue."),a=o,n[o].status=3,n[o].abortReason="set"):((0,v.hu)(0===n[o].status,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat($n(e.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&r.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));-1===a?gr(t,void 0):n.length=a+1,Dr(e.eventQueue_,wr(t),i);for(var s=0;s<r.length;s++)G(r[s])}}var ri=function(e,t){var n=ii(e),r=n.namespace;"firebase.com"===n.domain&&O(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||O("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&M("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new oe(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new xe(n.pathString)}},ii=function(e){var t="",n="",r="",i="",a="",o=!0,s="https",u=443;if("string"===typeof e){var c=e.indexOf("//");c>=0&&(s=e.substring(0,c-1),e=e.substring(c+2));var h=e.indexOf("/");-1===h&&(h=e.length);var d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(h,d)),h<d&&(i=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(a){}t+="/"+i}return t}(e.substring(h,d)));var f=function(e){var t={};"?"===e.charAt(0)&&(e=e.substring(1));var n,r=(0,l.Z)(e.split("&"));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(0!==i.length){var a=i.split("=");2===a.length?t[decodeURIComponent(a[0])]=decodeURIComponent(a[1]):M("Invalid query segment '".concat(i,"' in query '").concat(e,"'"))}}}catch(o){r.e(o)}finally{r.f()}return t}(e.substring(Math.min(e.length,d)));(c=t.indexOf(":"))>=0?(o="https"===s||"wss"===s,u=parseInt(t.substring(c+1),10)):c=t.length;var p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var v=t.indexOf(".");r=t.substring(0,v).toLowerCase(),n=t.substring(v+1),a=r}"ns"in f&&(a=f.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:o,scheme:s,pathString:i,namespace:a}},ai="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",oi=(function(){var e=0,t=[]}(),function(){function e(t,n,r,i){(0,h.Z)(this,e),this._repo=t,this._path=n,this._queryParams=r,this._orderByCalled=i}return(0,d.Z)(e,[{key:"key",get:function(){return Le(this._path)?null:De(this._path)}},{key:"ref",get:function(){return new si(this._repo,this._path)}},{key:"_queryIdentifier",get:function(){var e=At(this._queryParams),t=B(e);return"{}"===t?"default":t}},{key:"_queryObject",get:function(){return At(this._queryParams)}},{key:"isEqual",value:function(t){if(!((t=(0,v.m9)(t))instanceof e))return!1;var n=this._repo===t._repo,r=qe(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i}},{key:"toJSON",value:function(){return this.toString()}},{key:"toString",value:function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}]),e}());var si=function(e){(0,s.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,r,new Pt,!1)}return(0,d.Z)(n,[{key:"parent",get:function(){var e=Oe(this._path);return null===e?null:new n(this._repo,e)}},{key:"root",get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}}]),n}(oi);!function(e){(0,v.hu)(!jn,"__referenceConstructor has already been defined"),jn=e}(si),function(e){(0,v.hu)(!zn,"__referenceConstructor has already been defined"),zn=e}(si);var ui="FIREBASE_DATABASE_EMULATOR_HOST",ci={},li=!1;function hi(e,t,n,r,i){var a=r||e.options.databaseURL;void 0===a&&(e.options.projectId||O("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),P("Using default host for project ",e.options.projectId),a="".concat(e.options.projectId,"-default-rtdb.firebaseio.com"));var o,s=ri(a,i),u=s.repoInfo,c=void 0;"undefined"!==typeof process&&(c={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}[ui]),c?(o=!0,a="http://".concat(c,"?ns=").concat(u.namespace),u=(s=ri(a,i)).repoInfo):o=!s.repoInfo.secure;var l=i&&o?new ee(ee.OWNER):new J(e.name,e.options,t);Rr("Invalid Firebase Database URL",s),Le(s.path)||O("Database URL must point to the root of a Firebase Database (not including a child path).");var h=function(e,t,n,r){var i=ci[t.name];i||(i={},ci[t.name]=i);var a=i[e.toURLString()];a&&O("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return a=new Fr(e,li,n,r),i[e.toURLString()]=a,a}(u,e,l,new X(e.name,n));return new di(h,e)}var di=function(){function e(t,n){(0,h.Z)(this,e),this._repoInternal=t,this.app=n,this.type="database",this._instanceStarted=!1}return(0,d.Z)(e,[{key:"_repo",get:function(){return this._instanceStarted||(qr(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}},{key:"_root",get:function(){return this._rootInternal||(this._rootInternal=new si(this._repo,Ne())),this._rootInternal}},{key:"_delete",value:function(){return null!==this._rootInternal&&(!function(e,t){var n=ci[t];n&&n[e.key]===e||O("Database ".concat(t,"(").concat(e.repoInfo_,") has already been deleted.")),Vr(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}},{key:"_checkNotDeleted",value:function(e){null===this._rootInternal&&O("Cannot call "+e+" on a deleted database.")}}]),e}();function fi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,f.Mq)(),t=arguments.length>1?arguments[1]:void 0,n=(0,f.qX)(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){var r=(0,v.P0)("database");r&&pi.apply(void 0,[n].concat((0,c.Z)(r)))}return n}function pi(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(e=(0,v.m9)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&O("Cannot call useEmulator() after instance has already been initialized.");var i=e._repoInternal,a=void 0;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&O('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),a=new ee(ee.OWNER);else if(r.mockUserToken){var o="string"===typeof r.mockUserToken?r.mockUserToken:(0,v.Sg)(r.mockUserToken,e.app.options.projectId);a=new ee(o)}!function(e,t,n,r){e.repoInfo_=new oe("".concat(t,":").concat(n),!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}(i,t,n,a)}Ke.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Ke.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var vi;!function(e){m=e}(f.Jn),(0,f.Xd)(new p.wA("database",(function(e,t){var n=t.instanceIdentifier;return hi(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),n)}),"PUBLIC").setMultipleInstances(!0)),(0,f.KN)(y,g,vi),(0,f.KN)(y,g,"esm2017")},59073:function(e,t,n){n.d(t,{X3:function(){return m}});var r,i,a=n(1413),o=n(74165),s=n(15861),u=function(e,t){return t.some((function(t){return e instanceof t}))};var c=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap;var p={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return y(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function v(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(g(this),n),y(c.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return y(e.apply(g(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var a=e.call.apply(e,[g(this),t].concat(r));return h.set(a,t.sort?t.sort():[t]),y(a)}}function _(e){return"function"===typeof e?v(e):(e instanceof IDBTransaction&&function(e){if(!l.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",i),e.removeEventListener("error",a),e.removeEventListener("abort",a)},i=function(){t(),r()},a=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",a),e.addEventListener("abort",a)}));l.set(e,t)}}(e),u(e,r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,p):e)}function y(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",i),e.removeEventListener("error",a)},i=function(){t(y(e.result)),r()},a=function(){n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",a)}));return t.then((function(t){t instanceof IDBCursor&&c.set(t,e)})).catch((function(){})),f.set(t,e),t}(e);if(d.has(e))return d.get(e);var t=_(e);return t!==e&&(d.set(e,t),f.set(t,e)),t}var g=function(e){return f.get(e)};function m(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,i=n.upgrade,a=n.blocking,o=n.terminated,s=indexedDB.open(e,t),u=y(s);return i&&s.addEventListener("upgradeneeded",(function(e){i(y(s.result),e.oldVersion,e.newVersion,y(s.transaction))})),r&&s.addEventListener("blocked",(function(){return r()})),u.then((function(e){o&&e.addEventListener("close",(function(){return o()})),a&&e.addEventListener("versionchange",(function(){return a()}))})).catch((function(){})),u}var k=["get","getKey","getAll","getAllKeys","count"],b=["put","add","delete","clear"],w=new Map;function C(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(w.get(t))return w.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,i=b.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(i||k.includes(n))){var a=function(){var e=(0,s.Z)((0,o.Z)().mark((function e(t){var a,s,u,c,l,h,d=arguments;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(s=this.transaction(t,i?"readwrite":"readonly"),u=s.store,c=d.length,l=new Array(c>1?c-1:0),h=1;h<c;h++)l[h-1]=d[h];return r&&(u=u.index(l.shift())),e.next=6,Promise.all([(a=u)[n].apply(a,l),i&&s.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return w.set(t,a),a}}}p=function(e){return(0,a.Z)((0,a.Z)({},e),{},{get:function(t,n,r){return C(t,n)||e.get(t,n,r)},has:function(t,n){return!!C(t,n)||e.has(t,n)}})}(p)}}]);
//# sourceMappingURL=227.562fcf48.chunk.js.map